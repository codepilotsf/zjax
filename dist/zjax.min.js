(function(){"use strict";const C=["GET","POST","PUT","PATCH","DELETE"],q=["outer","inner"],L=["outer","inner","before","after","prepend","append","none","delete"],U=document.startViewTransition!==void 0,b=["id","z-swap","z-action","z-confirm","z-active","z-validate"],I=["document","window","once","prevent","stop"],v=["delay","debounce"],A=["click","auxclick","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","mouseenter","mouseleave","context"],N=["ctrl","shift","alt","meta"],E=["keydown","keyup"],K=["keyName","ctrl","shift","alt","meta"],W={enter:"Enter",escape:"Escape",tab:"Tab",backspace:"Backspace",delete:"Delete",insert:"Insert",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",arrowup:"ArrowUp",arrowdown:"ArrowDown",arrowleft:"ArrowLeft",arrowright:"ArrowRight",space:" ",comma:",",period:".",semicolon:";",singlequote:"'",doublequote:'"',backtick:"`",slash:"/",backslash:"\\",bracketleft:"[",bracketright:"]",curlybracketleft:"{",curlybracketright:"}",minus:"-",equal:"=",plus:"+",underscore:"_",ampersand:"&",asterisk:"*",at:"@",dollar:"$",percent:"%",caret:"^",exclamation:"!",tilde:"~",pipe:"|",colon:":",question:"?",underscore:"_",lessthan:"<",greaterthan:">",hash:"#"};function B(e,t){return!(E.includes(e.event)&&(e.modifiers.shift&&!t.shiftKey||e.modifiers.ctrl&&!t.ctrlKey||e.modifiers.alt&&!t.altKey||e.modifiers.meta&&!t.metaKey||e.modifiers.keyName&&t.key!==e.modifiers.keyName&&e.modifiers.keyName!=="any"))}function Z(e,t){return!(A.includes(e.event)&&(e.modifiers.shift&&!t.shiftKey||e.modifiers.ctrl&&!t.ctrlKey||e.modifiers.alt&&!t.altKey||e.modifiers.meta&&!t.metaKey))}function G(e,t){return!(e.modifiers.outside&&e.node.contains(t.target))}function H(e){return e.node.hasFiredOnce?!1:(e.modifiers.once&&(e.node.hasFiredOnce=!0),!0)}function J(e,t){return e.modifiers.prevent&&t.preventDefault(),e.modifiers.stop&&t.stopPropagation(),!0}async function V(e){return e.modifiers.delay&&await new Promise(t=>setTimeout(t,e.modifiers.delay)),!0}function T(e,t){let n;return function(...o){const i=this;clearTimeout(n),n=setTimeout(()=>{e.apply(i,o)},t)}}function $(e,t){const n=[];return n.push(...e.querySelectorAll(t)),!(e instanceof Document)&&e.matches(t)&&n.push(e),n}function m(e){return e instanceof Document?"#document":"<"+e.tagName.toLowerCase()+(e.id?"#"+e.id:"")+">"}function X(){return{debug:!1,transitions:!0,actions:{},errors:{},parse:function(){w(document),y(document)}}}function u(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}function z(e,t){const n=new Proxy(function(){},{apply(o,i,s){if(s.length===0)return e;if(s.length===1){const r=document.querySelector(s[0]);if(!r)throw new Error(`$('${s[0]}') did not match any elements in the DOM.`);return r}throw new Error("$() can be called with a maximum of one argument.")},get(o,i){if(i==="event")return o.event;if(i==="all")return function(s){return document.querySelectorAll(s)};if(i==="redirect")return function(s){window.location=s}}});return n.event=t,n}function _(e,t,n,o){if(zjax.errors[e.status]){zjax.errors[e.status](o);return}if(zjax.errors.catchAll){zjax.errors.catchAll(o);return}throw new Error(`${e.status} ${e.statusText} for ${n}`)}function x(e,t){const n=[],o=e.split(/,\s*(?=@)/);for(const i of o){const s=i.match(/^(@\w+[\w\-\.]+|@\[[\w\-\.\,\s]+\])?(.*)/),r=s[1]?s[1].replace(/[@\[\]\s]/g,""):"",a=s[2]?s[2].trim():"";if(!r)throw new Error(`Missing @<trigger> string in "${i}"`);const c=r.split(",");for(const l of c){const p=l.split("."),R=p.shift(),j=Q(R,p),g=Object.keys(j);let h;g.includes("document")?h=document:g.includes("window")||g.includes("outside")?h=window:h=t,n.push({event:R,modifiers:j,target:h,node:t,handlerString:a})}}return n}function Q(e,t){const n=A.includes(e),o=E.includes(e),i={};let s=o?"keyName":null;for(const r of t){if(I.includes(r)){i[r]=!0;continue}if(n&&N.includes(r)){i[r]=!0;continue}if(o&&K.includes(r)){i[r]=!0;continue}if(r==="once"){i[r]=!0;continue}if(r==="outside"&&(n||o)){i[r]=!0;continue}if(o&&s==="keyName"){i[s]=W[r]||r,s=null;continue}if(v.includes(r)){s=r;continue}if(s&&v.includes(s)){const a=r.match(/\d+s/),c=r.match(/\d+ms/);if(!a&&!c)throw new Error(`Invalid timer value: ${r}`);i[s]=a?parseInt(a[0])*1e3:parseInt(c[0]),s=null;continue}throw new Error(`Unknown trigger modifier in this context: ${r}`)}return i}let M=0;const f={};function k(e,t,n=!1){M++;const o=`handler${M}`,i=e.event==="mount"?`mount:${o}`:e.event;f[o]={target:e.target,event:i,handlerFunction:async function(s){if(!B(e,s)||!Z(e,s)||!G(e,s)||!H(e)||(J(e,s),!await V(e)))return;const r=n?z(e.node,s):s;if(T){T(t,e.modifiers.debounce)(r);return}await t(r)}},e.target.addEventListener(i,f[o].handlerFunction),ee(e,o),e.event==="mount"&&e.target.dispatchEvent(new Event(i))}function Y(){u("Removing all zjax event listeners");for(const e in f){const t=f[e];t.target.removeEventListener(t.event,t.handlerFunction),delete f[e]}}function ee(e,t){const n=new MutationObserver(o=>{for(const i of o)for(const s of i.removedNodes)if(s===e.node||s.contains(e.node)){f[t]&&e.target.removeEventListener(e.event,f[t].handlerFunction),delete f[t],zjax.debug&&u(`Removing event listener for ${m(e.node)} (no longer in DOM)`),n.disconnect();return}});n.observe(document,{childList:!0,subtree:!0})}async function w(e){const t=$(e,"[z-swap]");u(`Found ${t.length} z-swap nodes in ${m(e)}`);for(const n of t)try{const o=n.getAttribute("z-swap"),i=x(o,n);for(const s of i){const r=te(s),a=re(s,r);k(s,a,!0),u(`Added z-swap for '${s.event}' events to ${m(n)}`)}}catch(o){console.error(`ZJAX ERROR – Unable to parse z-swap: ${o.message}
`,n,o.stack)}}function te({handlerString:e,node:t}){e=fe(e);const n=e.split(/\s/);if(n.length<1||n.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");const o={},i=[];for(;n.length>0;){const s=n.shift(),r=ne(s);r?o[r[0]]=r[1]:i.push(s)}if(o.swaps=oe(i.join(" ")),o.method||(o.method=t.tagName==="FORM"&&t.method?t.method:"GET"),!o.endpoint)if(t.tagName==="FORM")o.endpoint=t.action;else if(t.tagName==="A")o.endpoint=t.href;else throw new Error("No endpoint inferrable or specified");return o}function ne(e){if(C.includes(e.toUpperCase()))return["method",e.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(e))return["endpoint",e]}function oe(e){const t=[];for(const n of e.split(",")){const o={},i=n.split("->")||[],s=i.pop(),[r,a]=s.split("|"),c=i[0]||"",[l,p]=(c==null?void 0:c.split("|"))||[null,null];if(o.response=l||r,o.target=r,o.responseType=(p==null?void 0:p.trim())||"outer",o.swapType=(a==null?void 0:a.trim())||"outer",o.responseType&&!q.includes(o.responseType))throw new Error(`Invalid swap type: ${o.responseType}`);if(o.swapType&&!L.includes(o.swapType))throw new Error(`Invalid swap type: ${o.swapType}`);if(o.response==="*"&&o.responseType!=="outer")throw new Error('Wild card "*" can not be piped to a Response Type');if(o.target==="*"&&o.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');t.push(o)}return t}function re(e,t){return async n=>{const o=e.node.tagName==="FORM"&&new FormData(n.target)||null;t.formData=o?de(o):null,u("z-swap triggered for",t);try{const[i,s]=await ie(t.method,t.endpoint,t.formData);if(!s.ok){const r=z(e.node,n);_(s,e,t.endpoint,r);return}for(const r of t.swaps){const a=document.querySelector(r.target);a&&a.classList.add("zjax-swapping");const[c,l]=se(i,r);u("Parsing incoming response for z-swaps"),c&&(w(c),y(c)),U&&zjax.transitions?document.startViewTransition(()=>{D(l,c,r.swapType,r.responseType)}):D(l,c,r.swapType,r.responseType)}}catch(i){console.error(`ZJAX ERROR – Unable to execute z-swap function: ${i.message}
`,e.node,i.stack)}}}async function ie(e,t,n){const o=await fetch(t,{method:e,body:n||null,headers:{"Content-Type":"application/x-www-form-urlencoded"}});let i=null;return o.ok&&(i=new DOMParser().parseFromString(await o.text(),"text/html"),u(`z-swap response from ${t} received and parsed`)),[i,o]}function se(e,t){let n;if(t.target==="*"){if(n=document.querySelector("body"),!n)throw new Error("Unable to find body element in local DOM to swap into")}else n=document.querySelector(t.target);const o=t.response==="*"?e:e.querySelector(t.response);if(!n&&t.swapType!=="none")throw new Error(`Target node '${t.target}' does not exist in local DOM`);if(!o&&t.swapType!=="none"&&t.swapType!=="delete")throw new Error(`Source node ${t.response} does not exist in response DOM`);return[o,n]}function ae(e,t){const n={},o=ce(e,"[id]");for(const i of o)if(F(t,`[id="${i.id}"]`)){const r=S(i),a=S(t);O(t),P(t,r),n[i.id]=a}return[t,n]}function D(e,t,n,o){t=o==="inner"?t.childNodes:t;let i;[t,i]=ae(e,t);const s=ue(t);if(n==="outer"){const r=e.parentNode;for(const a of s)r.insertBefore(a,e);r.removeChild(e),d(t,i);return}if(n==="inner"){e.textContent="";for(const r of s)e.appendChild(r);d(t,i);return}if(n==="before"){for(const r of s)e.parentNode.insertBefore(r,e);d(t,i);return}if(n==="after"){const r=e.parentNode;let a=e;for(const c of s)c===r.lastChild?r.appendChild(c):r.insertBefore(c,a.nextSibling),a=c;d(t,i);return}if(n==="prepend"){const r=e.firstChild;for(const a of s)r?e.insertBefore(a,r):e.appendChild(a);d(t,i);return}if(n==="append"){for(const r of s)e.appendChild(r);d(t,i);return}if(n==="delete"){e.remove();return}}function F(e,t){return e.matches(t)?e:e.querySelector(t)}function ce(e,t){const n=[];return e.matches(t)&&n.push(e),n.push(...e.querySelectorAll(t)),n}function S(e){const t=[];for(const n of Array.from(e.attributes).filter(o=>!b.includes(o.name)))t.push([n.name,n.value]);return t}function P(e,t){for(const[n,o]of t)e.setAttribute(n,o)}function O(e){for(const t of Array.from(e.attributes))b.includes(t.name)||e.removeAttribute(t.name)}async function d(e,t){setTimeout(()=>{for(const[n,o]of Object.entries(t)){const i=F(e,`[id="${n}"]`);i&&(O(i),P(i,o))}Object.keys(t).map(n=>`#${n}`).join(", ")},20)}function ue(e){if(e instanceof Document){const t=e.querySelector("html");if(t)return Array.from(t.childNodes);const n=document.createDocumentFragment();for(const o of e.childNodes)n.appendChild(o);return Array.from(n.childNodes)}return e instanceof NodeList||Array.isArray(e)?Array.from(e):[e]}function fe(e){return e.replace(/\s*,\s*/g,",")}function de(e){const t=new URLSearchParams;for(const[n,o]of e.entries())t.append(n,o);return t.toString()}function y(e){const t=$(e,"[z-action]");u(`Found ${t.length} z-action nodes in ${m(e)}`);for(const n of t)try{const o=n.getAttribute("z-action"),i=x(o,n);for(const s of i){const r=le(s);n.handlerId=k(s,r,!0),u(`Added z-action for '${s.event}' events to ${m(n)}`)}}catch(o){console.error(`ZJAX ERROR – Unable to parse z-action: ${o.message}
`,n,o.stack)}}function le(e){return async function(t){await pe(e)(t)}}function pe({handlerString:e}){if(e.match(/^(\w+)((\.\w+)*)$/)){const n=me(e);if(!n)throw new Error(`Unable to find z-action function: zjax.actions.${e}`);return n}try{return new Function("$",e)}catch(n){throw new Error(`z-action value is invalid: ${n.message}`)}}function me(e){let t=zjax.actions;const n=e.split("."),o=n.slice(0,-1),i=n[n.length-1];for(const s of o){if(!t[s])return;t=t[s]}return t[i]?t[i].bind(t):void 0}window.zjax=X(),document.addEventListener("DOMContentLoaded",()=>{u("Parsing DOM on document load"),w(document),y(document)}),document.addEventListener("turbo:load",()=>{u("Parsing DOM on turbo:load"),Y(),w(document),y(document)})})();
