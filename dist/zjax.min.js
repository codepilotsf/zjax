(()=>{var M=Object.defineProperty;var b=(t,e)=>{for(var n in e)M(t,n,{get:e[n],enumerable:!0})};var d={};b(d,{attrsToNotFreeze:()=>S,httpMethods:()=>j,isVTSupported:()=>R,responseTypes:()=>$,swapTypes:()=>O});var j=["GET","POST","PUT","PATCH","DELETE"],$=["outer","inner"],O=["outer","inner","before","after","prepend","append","none","delete"],R=document.startViewTransition!==void 0,S=["id","z-swap","z-action","z-confirm","z-active","z-validate"];var p={};b(p,{attachMutationObserver:()=>C,getMatchingNodes:()=>D,prettyNodeName:()=>v});function D(t,e){let n=[];return n.push(...t.querySelectorAll(e)),!(t instanceof Document)&&t.matches(e)&&n.push(t),n}function v(t){return t instanceof Document?"#document":"<"+t.tagName.toLowerCase()+(t.id?"#"+t.id:"")+">"}function C(t,e,n){let r=new MutationObserver(o=>{for(let i of o)for(let s of i.removedNodes)if(s===n||s.contains(n)){n.removeEventListener(t,e),zjax.debug&&u(`Removing event listener for ${v(n)} (no longer in DOM)`),r.disconnect();return}});r.observe(document.body,{childList:!0,subtree:!0})}function w(){return{debug:!1,transitions:!0,zjaxActions:{},userActions:{},actions:function(t,e){let n=e?t:null;if(n==="zjax")throw new Error("'zjax' is a reserved actions namespace");let r=e||t,o;n?(this.userActions[n]={},o=this.userActions[n]):o=this.userActions;let i=Object.keys(r);for(let s in i){let a=r[s];o[s]=a}}}}function u(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}async function g(t){let e=p.getMatchingNodes(t,"[z-swap]");u(`Found ${e.length} z-swap nodes in ${p.prettyNodeName(t)}`);for(let n of e)try{let r=n.getAttribute("z-swap"),o=N(r,n),i=P(o,n),s=o.trigger==="load"?"zjax:load":o.trigger;n.addEventListener(s,i),p.attachMutationObserver(s,i,n),s==="zjax:load"&&n.dispatchEvent(new CustomEvent("zjax:load")),u(`Added z-swap for '${o.trigger}' events to ${p.prettyNodeName(n)}`)}catch(r){console.error(`ZJAX ERROR \u2013 Unable to parse z-swap: ${r.message}
`,n,r.stack)}}function N(t,e){let r=W(t).split(/\s/);if(r.length<1||r.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");let o={},i=[];for(;r.length>0;){let s=r.shift(),a=F(s);a?o[a[0]]=a[1]:i.push(s)}if(o.swaps=Z(i.join(" ")),o.trigger||(o.trigger=e.tagName==="FORM"?"submit":"click"),o.method||(o.method=e.tagName==="FORM"?"POST":"GET"),!o.endpoint)if(e.tagName==="FORM")o.endpoint=e.action;else if(e.tagName==="A")o.endpoint=e.href;else throw new Error("No endpoint inferrable or specified");if(o.trigger==="submit"&&e.tagName!=="FORM")throw new Error("@submit trigger is only available on <FORM> elements");return o}function F(t){if(t.startsWith("@"))return["trigger",t.substr(1)];if(d.httpMethods.includes(t.toUpperCase()))return["method",t.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(t))return["endpoint",t]}function Z(t){let e=[];for(let n of t.split(",")){let r={},o=n.split("->")||[],i=o.pop(),[s,a]=i.split("|"),c=o[0]||"",[h,f]=c?.split("|")||[null,null];if(r.response=h||s,r.target=s,r.responseType=f?.trim()||"outer",r.swapType=a?.trim()||"outer",r.responseType&&!d.responseTypes.includes(r.responseType))throw new Error(`Invalid swap type: ${r.responseType}`);if(r.swapType&&!d.swapTypes.includes(r.swapType))throw new Error(`Invalid swap type: ${r.swapType}`);if(r.response==="*"&&r.responseType!=="outer")throw new Error('Wild card "*" can not be piped to a Response Type');if(r.target==="*"&&r.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');e.push(r)}return e}function P(t,e){return async n=>{formData=e.tagName==="FORM"&&new FormData(n.target)||null,n.preventDefault(),n.stopPropagation(),u("z-swap triggered for",t);try{let r=new CustomEvent("zjax:request",{detail:{node:e,trigger:t.trigger,method:t.method,endpoint:t.endpoint,formData}});document.dispatchEvent(r);let o=await q(t.method,t.endpoint,formData),i=o.body||o.documentElement,s=new CustomEvent("zjax:response",{detail:{node:e,response:i.innerHTML.replace(/\n|\s{2,}/g,"")}});document.dispatchEvent(s);for(let c of t.swaps){let h=document.querySelector(c.target);h&&h.classList.add("zjax-swapping");let[f,y]=L(o,c);u("Parsing incoming response for z-swaps"),f&&(g(f),m(f)),d.isVTSupported&&zjax.transitions?document.startViewTransition(()=>{E(y,f,c.swapType,c.responseType)}):E(y,f,c.swapType,c.responseType)}let a=new CustomEvent("zjax:swap",{detail:{node:e,swaps:t.swaps}});document.dispatchEvent(a)}catch(r){console.error(`ZJAX ERROR \u2013 Unable to execute z-swap function: ${r.message}
`,e,r.stack)}}}async function q(t,e,n){let r=await fetch(e,{method:t,body:n||null});if(!r.ok)throw new Error(`${r.status} ${r.statusText} for ${e}`);let o=new DOMParser().parseFromString(await r.text(),"text/html");return u(`z-swap response from ${e} received and parsed`),o}function L(t,e){let n;if(e.target==="*"){if(n=document.querySelector("body"),!n)throw new Error("Unable to find body element in local DOM to swap into")}else n=document.querySelector(e.target);let r=e.response==="*"?t:t.querySelector(e.response);if(!n&&e.swapType!=="none")throw new Error(`Target node '${e.target}' does not exist in local DOM`);if(!r&&e.swapType!=="none"&&e.swapType!=="delete")throw new Error(`Source node ${e.response} does not exist in response DOM`);return[r,n]}function U(t,e){let n={},r=k(t,"[id]");for(let o of r)if(A(e,`[id="${o.id}"]`)){let s=x(o),a=x(e);z(e),T(e,s),n[o.id]=a}return[e,n]}function E(t,e,n,r){e=r==="inner"?e.childNodes:e;let o;[e,o]=U(t,e);let i=I(e);if(n==="outer"){let s=t.parentNode;for(let a of i)s.insertBefore(a,t);s.removeChild(t),l(e,o);return}if(n==="inner"){t.textContent="";for(let s of i)t.appendChild(s);l(e,o);return}if(n==="before"){for(let s of i)t.parentNode.insertBefore(s,t);l(e,o);return}if(n==="after"){let s=t.parentNode,a=t;for(let c of i)c===s.lastChild?s.appendChild(c):s.insertBefore(c,a.nextSibling),a=c;l(e,o);return}if(n==="prepend"){let s=t.firstChild;for(let a of i)s?t.insertBefore(a,s):t.appendChild(a);l(e,o);return}if(n==="append"){for(let s of i)t.appendChild(s);l(e,o);return}if(n==="delete"){t.remove();return}}function A(t,e){return t.matches(e)?t:t.querySelector(e)}function k(t,e){let n=[];return t.matches(e)&&n.push(t),n.push(...t.querySelectorAll(e)),n}function x(t){let e=[];for(let n of Array.from(t.attributes).filter(r=>!d.attrsToNotFreeze.includes(r.name)))e.push([n.name,n.value]);return e}function T(t,e){for(let[n,r]of e)t.setAttribute(n,r)}function z(t){for(let e of Array.from(t.attributes))d.attrsToNotFreeze.includes(e.name)||t.removeAttribute(e.name)}async function l(t,e){setTimeout(()=>{for(let[r,o]of Object.entries(e)){let i=A(t,`[id="${r}"]`);i&&(z(i),T(i,o))}let n=Object.keys(e).map(r=>`#${r}`).join(", ");if(n){let r=new CustomEvent("zjax:settle",{detail:{node:t,elementIds:n}});document.dispatchEvent(r)}},20)}function I(t){if(t instanceof Document){let e=t.querySelector("html");if(e)return Array.from(e.childNodes);let n=document.createDocumentFragment();for(let r of t.childNodes)n.appendChild(r);return Array.from(n.childNodes)}return t instanceof NodeList||Array.isArray(t)?Array.from(t):[t]}function W(t){return t.replace(/\s*,\s*/g,",")}function m(t){let e=p.getMatchingNodes(t,"[z-action]");u(`Found ${e.length} z-action nodes in ${p.prettyNodeName(t)}`);for(let n of e)try{let r=n.getAttribute("z-action"),o=B(r,n),i=G(n);n.addEventListener(o.trigger,async function(s){try{i.event=s;let a=await o.handler(i),c=new CustomEvent("action",{detail:{result:a,event:s}});a&&n.dispatchEvent(c)}catch(a){console.error(`ZJAX ERROR \u2013 Unable to execute z-action: ${a.message}
`,n,a.stack)}}),p.attachMutationObserver(o.trigger,o.handler,n),o.trigger==="load"&&n.dispatchEvent(new Event("load")),u(`Added z-action for '${o.trigger}' events to ${p.prettyNodeName(n)}`)}catch(r){console.error(`ZJAX ERROR \u2013 Unable to parse z-action: ${r.message}
`,n,r.stack)}}function G(t){return new Proxy(function(){},{apply(e,n,r){if(r.length===0)return t;if(r.length===1){let o=document.querySelector(r[0]);if(!o)throw new Error(`$('${r[0]}') did not match any elements in the DOM.`);return o}throw new Error("$() can be called with a maximum of one argument.")},get(e,n){if(n==="event")return e.event;if(n==="all")return function(r){return document.querySelectorAll(r)}}})}function B(t,e){let n=t.match(/^\s*(?:@(\w+))?\s*(.*)/);if(!n)throw new Error("z-action value is invalid.");let r=n[1];r||(r=e.tagName==="FORM"?"submit":"click");let o=n[2],i=o.match(/^(?:(\w+)\.)?(\w+)$/);if(i){let s=i[1],a=i[2],c=zjax&&zjax.userActions;if(s){if(!(c[s]&&c[s][a]))throw new Error(`Unknown action: ${s}.${a}`);return{trigger:r,handler:c[s][a]}}else{if(!c[a])throw new Error(`Unknown action: ${a}`);return{trigger:r,handler:c[a]}}}try{return{trigger:r,handler:new Function("$",o)}}catch(s){throw new Error(`z-action value is invalid: ${s.message}`)}}window.zjax=w();document.addEventListener("DOMContentLoaded",()=>{u("Parsing DOM"),g(document),m(document);let t=Array.isArray(window.zjax.parseOn)?window.zjax.parseOn:[window.zjax.parseOn];for(let e of t)document.addEventListener(e,()=>{u("Reparsing DOM on",e),g(document),m(document)})});})();
