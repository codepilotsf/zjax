(()=>{var $=Object.defineProperty;var v=(t,n)=>{for(var e in n)$(t,e,{get:n[e],enumerable:!0})};var l={};v(l,{attrsToNotFreeze:()=>R,httpMethods:()=>j,isVTSupported:()=>O,responseTypes:()=>M,swapTypes:()=>D});var j=["GET","POST","PUT","PATCH","DELETE"],M=["outer","inner"],D=["outer","inner","before","after","prepend","append","none","delete"],O=document.startViewTransition!==void 0,R=["id","z-swap","z-action","z-confirm","z-active","z-validate"];var d={};v(d,{attachMutationObserver:()=>P,getMatchingNodes:()=>C,getStatements:()=>N,prettyNodeName:()=>E});function C(t,n){let e=[];return e.push(...t.querySelectorAll(n)),!(t instanceof Document)&&t.matches(n)&&e.push(t),e}function N(t,n){let e=[],o=t.split(/,\s*(?=@)/);for(let s of o){let r=s.match(/^(@\w+|@\[[^\]]+\])?(.*)/),i=r[1]?r[1].replace(/@\[\s\]/):"",a=r[2]?r[2].trim():"",c=F(i,n);for(let u of c)e.push({trigger:u,handlerString:a})}return e}function F(t,n){return t?t.replace(/[@\[\s+\]]/g,"").split(","):n==="FORM"?["submit"]:["click"]}function E(t){return t instanceof Document?"#document":"<"+t.tagName.toLowerCase()+(t.id?"#"+t.id:"")+">"}function P(t,n,e){let o=new MutationObserver(s=>{for(let r of s)for(let i of r.removedNodes)if(i===e||i.contains(e)){e.removeEventListener(t,n),zjax.debug&&p(`Removing event listener for ${E(e)} (no longer in DOM)`),o.disconnect();return}});o.observe(document.body,{childList:!0,subtree:!0})}function y(){return{debug:!1,transitions:!0,zjaxActions:{},userActions:{},actions:function(t,n){let e=n?t:null;if(e==="zjax")throw new Error("'zjax' is a reserved actions namespace");let o=n||t,s;e?(this.userActions[e]={},s=this.userActions[e]):s=this.userActions;let r=Object.keys(o);for(let i of r){let a=o[i];s[i]=a}}}}function p(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}async function w(t){let n=d.getMatchingNodes(t,"[z-swap]");p(`Found ${n.length} z-swap nodes in ${d.prettyNodeName(t)}`);for(let e of n)try{let o=e.getAttribute("z-swap"),s=d.getStatements(o,e.tagName);for(let{trigger:r,handlerString:i}of s){let a=Z(r,i,e),c=q(a,e);a.trigger=a.trigger==="load"?"zjax:load":a.trigger,e.addEventListener(a.trigger,c),d.attachMutationObserver(a.trigger,c,e),r==="zjax:load"&&e.dispatchEvent(new CustomEvent("zjax:load")),p(`Added z-swap for '${a.trigger}' events to ${d.prettyNodeName(e)}`)}}catch(o){console.error(`ZJAX ERROR \u2013 Unable to parse z-swap: ${o.message}
`,e,o.stack)}}function Z(t,n,e){let s=J(n).split(/\s/);if(s.length<1||s.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");let r={trigger:t},i=[];for(;s.length>0;){let a=s.shift(),c=L(a);c?r[c[0]]=c[1]:i.push(a)}if(r.swaps=U(i.join(" ")),r.method||(r.method=e.tagName==="FORM"?"POST":"GET"),!r.endpoint)if(e.tagName==="FORM")r.endpoint=e.action;else if(e.tagName==="A")r.endpoint=e.href;else throw new Error("No endpoint inferrable or specified");return r}function L(t){if(l.httpMethods.includes(t.toUpperCase()))return["method",t.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(t))return["endpoint",t]}function U(t){let n=[];for(let e of t.split(",")){let o={},s=e.split("->")||[],r=s.pop(),[i,a]=r.split("|"),c=s[0]||"",[u,f]=c?.split("|")||[null,null];if(o.response=u||i,o.target=i,o.responseType=f?.trim()||"outer",o.swapType=a?.trim()||"outer",o.responseType&&!l.responseTypes.includes(o.responseType))throw new Error(`Invalid swap type: ${o.responseType}`);if(o.swapType&&!l.swapTypes.includes(o.swapType))throw new Error(`Invalid swap type: ${o.swapType}`);if(o.response==="*"&&o.responseType!=="outer")throw new Error('Wild card "*" can not be piped to a Response Type');if(o.target==="*"&&o.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');n.push(o)}return n}function q(t,n){return async e=>{e.preventDefault(),e.stopPropagation();let o=n.tagName==="FORM"&&new FormData(e.target)||null;t.formData=o?V(o):null,p("z-swap triggered for",t);try{let s=new CustomEvent("zjax:request",{detail:{node:n,trigger:t.trigger,method:t.method,endpoint:t.endpoint,formData:t.formData}});document.dispatchEvent(s);let r=await k(t.method,t.endpoint,t.formData),i=r.body||r.documentElement,a=new CustomEvent("zjax:response",{detail:{node:n,response:i.innerHTML.replace(/\n|\s{2,}/g,"")}});document.dispatchEvent(a);for(let u of t.swaps){let f=document.querySelector(u.target);f&&f.classList.add("zjax-swapping");let[m,b]=I(r,u);p("Parsing incoming response for z-swaps"),m&&(w(m),h(m)),l.isVTSupported&&zjax.transitions?document.startViewTransition(()=>{x(b,m,u.swapType,u.responseType)}):x(b,m,u.swapType,u.responseType)}let c=new CustomEvent("zjax:swap",{detail:{node:n,swaps:t.swaps}});document.dispatchEvent(c)}catch(s){console.error(`ZJAX ERROR \u2013 Unable to execute z-swap function: ${s.message}
`,n,s.stack)}}}async function k(t,n,e){let o=await fetch(n,{method:t,body:e||null,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!o.ok)throw new Error(`${o.status} ${o.statusText} for ${n}`);let s=new DOMParser().parseFromString(await o.text(),"text/html");return p(`z-swap response from ${n} received and parsed`),s}function I(t,n){let e;if(n.target==="*"){if(e=document.querySelector("body"),!e)throw new Error("Unable to find body element in local DOM to swap into")}else e=document.querySelector(n.target);let o=n.response==="*"?t:t.querySelector(n.response);if(!e&&n.swapType!=="none")throw new Error(`Target node '${n.target}' does not exist in local DOM`);if(!o&&n.swapType!=="none"&&n.swapType!=="delete")throw new Error(`Source node ${n.response} does not exist in response DOM`);return[o,e]}function W(t,n){let e={},o=G(t,"[id]");for(let s of o)if(A(n,`[id="${s.id}"]`)){let i=T(s),a=T(n);S(n),z(n,i),e[s.id]=a}return[n,e]}function x(t,n,e,o){n=o==="inner"?n.childNodes:n;let s;[n,s]=W(t,n);let r=B(n);if(e==="outer"){let i=t.parentNode;for(let a of r)i.insertBefore(a,t);i.removeChild(t),g(n,s);return}if(e==="inner"){t.textContent="";for(let i of r)t.appendChild(i);g(n,s);return}if(e==="before"){for(let i of r)t.parentNode.insertBefore(i,t);g(n,s);return}if(e==="after"){let i=t.parentNode,a=t;for(let c of r)c===i.lastChild?i.appendChild(c):i.insertBefore(c,a.nextSibling),a=c;g(n,s);return}if(e==="prepend"){let i=t.firstChild;for(let a of r)i?t.insertBefore(a,i):t.appendChild(a);g(n,s);return}if(e==="append"){for(let i of r)t.appendChild(i);g(n,s);return}if(e==="delete"){t.remove();return}}function A(t,n){return t.matches(n)?t:t.querySelector(n)}function G(t,n){let e=[];return t.matches(n)&&e.push(t),e.push(...t.querySelectorAll(n)),e}function T(t){let n=[];for(let e of Array.from(t.attributes).filter(o=>!l.attrsToNotFreeze.includes(o.name)))n.push([e.name,e.value]);return n}function z(t,n){for(let[e,o]of n)t.setAttribute(e,o)}function S(t){for(let n of Array.from(t.attributes))l.attrsToNotFreeze.includes(n.name)||t.removeAttribute(n.name)}async function g(t,n){setTimeout(()=>{for(let[o,s]of Object.entries(n)){let r=A(t,`[id="${o}"]`);r&&(S(r),z(r,s))}let e=Object.keys(n).map(o=>`#${o}`).join(", ");if(e){let o=new CustomEvent("zjax:settle",{detail:{node:t,elementIds:e}});document.dispatchEvent(o)}},20)}function B(t){if(t instanceof Document){let n=t.querySelector("html");if(n)return Array.from(n.childNodes);let e=document.createDocumentFragment();for(let o of t.childNodes)e.appendChild(o);return Array.from(e.childNodes)}return t instanceof NodeList||Array.isArray(t)?Array.from(t):[t]}function J(t){return t.replace(/\s*,\s*/g,",")}function V(t){let n=new URLSearchParams;for(let[e,o]of t.entries())n.append(e,o);return n.toString()}function h(t){let n=d.getMatchingNodes(t,"[z-action]");p(`Found ${n.length} z-action nodes in ${d.prettyNodeName(t)}`);for(let e of n)try{let o=e.getAttribute("z-action"),s=d.getStatements(o,e.tagName);for(let{trigger:r,handlerString:i}of s){let a=H(i,e),c=X(e);e.addEventListener(r,async function(u){u.preventDefault(),u.stopPropagation();try{c.event=u;let f=await a(c),m=new CustomEvent("action",{detail:{result:f,event:u}});f&&e.dispatchEvent(m)}catch(f){console.error(`ZJAX ERROR \u2013 Unable to execute z-action: ${f.message}
`,e,f.stack)}}),d.attachMutationObserver(r,a,e),r==="load"&&e.dispatchEvent(new Event("load")),p(`Added z-action for '${r}' events to ${d.prettyNodeName(e)}`)}}catch(o){console.error(`ZJAX ERROR \u2013 Unable to parse z-action: ${o.message}
`,e,o.stack)}}function X(t){return new Proxy(function(){},{apply(n,e,o){if(o.length===0)return t;if(o.length===1){let s=document.querySelector(o[0]);if(!s)throw new Error(`$('${o[0]}') did not match any elements in the DOM.`);return s}throw new Error("$() can be called with a maximum of one argument.")},get(n,e){if(e==="event")return n.event;if(e==="all")return function(o){return document.querySelectorAll(o)}}})}function H(t,n){let e=t.match(/^(?:(\w+)\.)?(\w+)$/);if(e){let o=e[1],s=e[2],r=zjax&&zjax.userActions;if(o){if(!(r[o]&&r[o][s]))throw new Error(`Unknown action: ${o}.${s}`);return r[o][s].bind(r[o])}else{if(!r[s])throw new Error(`Unknown action: ${s}`);return r[s].bind(r)}}try{return new Function("$",t)}catch(o){throw new Error(`z-action value is invalid: ${o.message}`)}}window.zjax=y();document.addEventListener("DOMContentLoaded",()=>{p("Parsing DOM"),w(document),h(document);let t=Array.isArray(window.zjax.parseOn)?window.zjax.parseOn:[window.zjax.parseOn];for(let n of t)document.addEventListener(n,()=>{p("Reparsing DOM on",n),w(document),h(document)})});})();
