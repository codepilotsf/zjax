(()=>{var $=Object.defineProperty;var x=(e,n)=>{for(var t in n)$(e,t,{get:n[t],enumerable:!0})};var d={};x(d,{attrsToNotFreeze:()=>N,globalTriggerModifiers:()=>R,httpMethods:()=>j,isVTSupported:()=>k,keyboardEvents:()=>L,keyboardTriggerModifiers:()=>Z,mouseEvents:()=>C,mouseTriggerModifiers:()=>P,responseTypes:()=>O,swapTypes:()=>D,timerTriggerModifiers:()=>F});var j=["GET","POST","PUT","PATCH","DELETE"],O=["outer","inner"],D=["outer","inner","before","after","prepend","append","none","delete"],k=document.startViewTransition!==void 0,N=["id","z-swap","z-action","z-confirm","z-active","z-validate"],R=["document","window","once","prevent","stop"],F=["delay","debounce"],C=["click","auxclick","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","mouseenter","mouseleave","context"],P=["outside","ctrl","shift","alt","cmd","meta"],L=["keydown","keyup","keypress"],Z=["keyName","shift","alt","ctrl","meta","cmd"];var p={};x(p,{attachMutationObserver:()=>B,getDocumentOrWindow:()=>W,getMatchingNodes:()=>U,getStatements:()=>q,prettyNodeName:()=>E,sleep:()=>G});function U(e,n){let t=[];return t.push(...e.querySelectorAll(n)),!(e instanceof Document)&&e.matches(n)&&t.push(e),t}function q(e,n){let t=[],r=e.split(/,\s*(?=@)/);for(let i of r){let s=i.match(/^(@\w+[\w\-\.]+|@\[[\w\-\.\,]+\])?(.*)/),o=s[1]?s[1].replace(/[@\[\]\s]+/,""):"",a=s[2]?s[2].trim():"",c=I(o,n);for(let{trigger:f,modifiers:u}of c)t.push({trigger:f,modifiers:u,handlerString:a})}return t}function I(e,n){if(!e)return n==="FORM"?[{trigger:"submit"}]:[{trigger:"click"}];let t=[];for(let r of e.split(","))t.push(K(r));return t}function K(e){let n=e.split("."),t=n.shift(),r=d.mouseEvents.includes(t),i=d.keyboardEvents.includes(t),s={},o=i?"keyName":null;for(let a of n){if(previousModifier=a,d.globalTriggerModifiers.includes(a)){s[a]=!0;continue}if(r&&d.mouseTriggerModifiers.includes(a)){s[a]=!0;continue}if(i&&d.keyboardTriggerModifiers.includes(a)){s[a]=!0;continue}if(i&&o==="keyName"){s[o]=a,o=null;continue}if(d.timerTriggerModifiers.includes(a)){o=a;continue}if(o&&d.timerTriggerModifiers.includes(o)){let c=a.match(/\d+s/),f=a.match(/\d+ms/);if(!c&&!f)throw new Error(`Invalid timer value: ${a}`);s[o]=c?parseInt(c[0])*1e3:parseInt(f[0]),o=null;continue}throw new Error(`Unknown trigger modifier in this context: ${a}`)}return{trigger:t,modifiers:s}}function W(e){return e.document?document:e.window||e.outside?window:null}async function G(e){await new Promise(n=>setTimeout(n,e))}function E(e){return e instanceof Document?"#document":"<"+e.tagName.toLowerCase()+(e.id?"#"+e.id:"")+">"}function B(e,n,t){let r=new MutationObserver(i=>{for(let s of i)for(let o of s.removedNodes)if(o===t||o.contains(t)){t.removeEventListener(e,n),zjax.debug&&l(`Removing event listener for ${E(t)} (no longer in DOM)`),r.disconnect();return}});r.observe(document.body,{childList:!0,subtree:!0})}function y(){return{debug:!1,transitions:!0,zjaxActions:{},userActions:{},actions:function(e,n){let t=n?e:null;if(t==="zjax")throw new Error("'zjax' is a reserved actions namespace");let r=n||e,i;t?(this.userActions[t]={},i=this.userActions[t]):i=this.userActions;let s=Object.keys(r);for(let o of s){let a=r[o];i[o]=a}}}}function l(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}async function w(e){let n=p.getMatchingNodes(e,"[z-swap]");l(`Found ${n.length} z-swap nodes in ${p.prettyNodeName(e)}`);for(let t of n)try{let r=t.getAttribute("z-swap"),i=p.getStatements(r,t.tagName);for(let{trigger:s,modifiers:o,handlerString:a}of i){let c=J(s,a,t),f=H(c,t);c.trigger=c.trigger==="load"?"zjax:load":c.trigger,t.addEventListener(c.trigger,f),p.attachMutationObserver(c.trigger,f,t),s==="zjax:load"&&t.dispatchEvent(new CustomEvent("zjax:load")),l(`Added z-swap for '${c.trigger}' events to ${p.prettyNodeName(t)}`)}}catch(r){console.error(`ZJAX ERROR \u2013 Unable to parse z-swap: ${r.message}
`,t,r.stack)}}function J(e,n,t){let i=ne(n).split(/\s/);if(i.length<1||i.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");let s={trigger:e},o=[];for(;i.length>0;){let a=i.shift(),c=V(a);c?s[c[0]]=c[1]:o.push(a)}if(s.swaps=X(o.join(" ")),s.method||(s.method=t.tagName==="FORM"?"POST":"GET"),!s.endpoint)if(t.tagName==="FORM")s.endpoint=t.action;else if(t.tagName==="A")s.endpoint=t.href;else throw new Error("No endpoint inferrable or specified");return s}function V(e){if(d.httpMethods.includes(e.toUpperCase()))return["method",e.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(e))return["endpoint",e]}function X(e){let n=[];for(let t of e.split(",")){let r={},i=t.split("->")||[],s=i.pop(),[o,a]=s.split("|"),c=i[0]||"",[f,u]=c?.split("|")||[null,null];if(r.response=f||o,r.target=o,r.responseType=u?.trim()||"outer",r.swapType=a?.trim()||"outer",r.responseType&&!d.responseTypes.includes(r.responseType))throw new Error(`Invalid swap type: ${r.responseType}`);if(r.swapType&&!d.swapTypes.includes(r.swapType))throw new Error(`Invalid swap type: ${r.swapType}`);if(r.response==="*"&&r.responseType!=="outer")throw new Error('Wild card "*" can not be piped to a Response Type');if(r.target==="*"&&r.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');n.push(r)}return n}function H(e,n){return async t=>{t.preventDefault(),t.stopPropagation();let r=n.tagName==="FORM"&&new FormData(t.target)||null;e.formData=r?re(r):null,l("z-swap triggered for",e);try{let i=new CustomEvent("zjax:request",{detail:{node:n,trigger:e.trigger,method:e.method,endpoint:e.endpoint,formData:e.formData}});document.dispatchEvent(i);let s=await _(e.method,e.endpoint,e.formData),o=s.body||s.documentElement,a=new CustomEvent("zjax:response",{detail:{node:n,response:o.innerHTML.replace(/\n|\s{2,}/g,"")}});document.dispatchEvent(a);for(let f of e.swaps){let u=document.querySelector(f.target);u&&u.classList.add("zjax-swapping");let[h,b]=Q(s,f);l("Parsing incoming response for z-swaps"),h&&(w(h),g(h)),d.isVTSupported&&zjax.transitions?document.startViewTransition(()=>{T(b,h,f.swapType,f.responseType)}):T(b,h,f.swapType,f.responseType)}let c=new CustomEvent("zjax:swap",{detail:{node:n,swaps:e.swaps}});document.dispatchEvent(c)}catch(i){console.error(`ZJAX ERROR \u2013 Unable to execute z-swap function: ${i.message}
`,n,i.stack)}}}async function _(e,n,t){let r=await fetch(n,{method:e,body:t||null,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!r.ok)throw new Error(`${r.status} ${r.statusText} for ${n}`);let i=new DOMParser().parseFromString(await r.text(),"text/html");return l(`z-swap response from ${n} received and parsed`),i}function Q(e,n){let t;if(n.target==="*"){if(t=document.querySelector("body"),!t)throw new Error("Unable to find body element in local DOM to swap into")}else t=document.querySelector(n.target);let r=n.response==="*"?e:e.querySelector(n.response);if(!t&&n.swapType!=="none")throw new Error(`Target node '${n.target}' does not exist in local DOM`);if(!r&&n.swapType!=="none"&&n.swapType!=="delete")throw new Error(`Source node ${n.response} does not exist in response DOM`);return[r,t]}function Y(e,n){let t={},r=ee(e,"[id]");for(let i of r)if(A(n,`[id="${i.id}"]`)){let o=v(i),a=v(n);z(n),M(n,o),t[i.id]=a}return[n,t]}function T(e,n,t,r){n=r==="inner"?n.childNodes:n;let i;[n,i]=Y(e,n);let s=te(n);if(t==="outer"){let o=e.parentNode;for(let a of s)o.insertBefore(a,e);o.removeChild(e),m(n,i);return}if(t==="inner"){e.textContent="";for(let o of s)e.appendChild(o);m(n,i);return}if(t==="before"){for(let o of s)e.parentNode.insertBefore(o,e);m(n,i);return}if(t==="after"){let o=e.parentNode,a=e;for(let c of s)c===o.lastChild?o.appendChild(c):o.insertBefore(c,a.nextSibling),a=c;m(n,i);return}if(t==="prepend"){let o=e.firstChild;for(let a of s)o?e.insertBefore(a,o):e.appendChild(a);m(n,i);return}if(t==="append"){for(let o of s)e.appendChild(o);m(n,i);return}if(t==="delete"){e.remove();return}}function A(e,n){return e.matches(n)?e:e.querySelector(n)}function ee(e,n){let t=[];return e.matches(n)&&t.push(e),t.push(...e.querySelectorAll(n)),t}function v(e){let n=[];for(let t of Array.from(e.attributes).filter(r=>!d.attrsToNotFreeze.includes(r.name)))n.push([t.name,t.value]);return n}function M(e,n){for(let[t,r]of n)e.setAttribute(t,r)}function z(e){for(let n of Array.from(e.attributes))d.attrsToNotFreeze.includes(n.name)||e.removeAttribute(n.name)}async function m(e,n){setTimeout(()=>{for(let[r,i]of Object.entries(n)){let s=A(e,`[id="${r}"]`);s&&(z(s),M(s,i))}let t=Object.keys(n).map(r=>`#${r}`).join(", ");if(t){let r=new CustomEvent("zjax:settle",{detail:{node:e,elementIds:t}});document.dispatchEvent(r)}},20)}function te(e){if(e instanceof Document){let n=e.querySelector("html");if(n)return Array.from(n.childNodes);let t=document.createDocumentFragment();for(let r of e.childNodes)t.appendChild(r);return Array.from(t.childNodes)}return e instanceof NodeList||Array.isArray(e)?Array.from(e):[e]}function ne(e){return e.replace(/\s*,\s*/g,",")}function re(e){let n=new URLSearchParams;for(let[t,r]of e.entries())n.append(t,r);return n.toString()}function g(e){let n=p.getMatchingNodes(e,"[z-action]");l(`Found ${n.length} z-action nodes in ${p.prettyNodeName(e)}`);for(let t of n)try{let r=t.getAttribute("z-action"),i=p.getStatements(r,t.tagName);for(let{trigger:s,modifiers:o,handlerString:a}of i){let c=se(a,t);(p.getDocumentOrWindow(o)||t).addEventListener(s,async function(u){d.keyboardEvents.includes(s)&&(o.shift&&!u.shiftKey||o.ctrl&&!u.ctrlKey||o.alt&&!u.altKey||o.meta&&!u.metaKey||o.keyName&&u.key!==o.keyName)||d.mouseEvents.includes(s)&&(o.shift&&!u.shiftKey||o.ctrl&&!u.ctrlKey||o.alt&&!u.altKey||o.meta&&!u.metaKey)||(o.prevent&&u.preventDefault(),o.stop&&u.stopPropagation(),!(o.outside&&t.contains(u.target))&&(t.hasFiredOnce||(o.once&&(t.hasFiredOnce=!0),o.delay&&await p.sleep(o.delay),o.debounce?(t.debounceTimeout&&clearTimeout(t.debounceTimeout),t.debounceTimeout=setTimeout(async()=>{delete t.debounceTimeout,await S(t,u,c)},o.debounce)):await S(t,u,c))))}),p.attachMutationObserver(s,c,t),s==="load"&&t.dispatchEvent(new Event("load")),l(`Added z-action for '${s}' events to ${p.prettyNodeName(t)}`)}}catch(r){console.error(`ZJAX ERROR \u2013 Unable to parse z-action: ${r.message}
`,t,r.stack)}}async function S(e,n,t){try{let r=oe(e);r.event=n;let i=await t(r),s=new CustomEvent("action",{detail:{result:i,event:n}});i&&e.dispatchEvent(s)}catch(r){console.error(`ZJAX ERROR \u2013 Unable to execute z-action: ${r.message}
`,e,r.stack)}}function oe(e){return new Proxy(function(){},{apply(n,t,r){if(r.length===0)return e;if(r.length===1){let i=document.querySelector(r[0]);if(!i)throw new Error(`$('${r[0]}') did not match any elements in the DOM.`);return i}throw new Error("$() can be called with a maximum of one argument.")},get(n,t){if(t==="event")return n.event;if(t==="all")return function(r){return document.querySelectorAll(r)}}})}function se(e,n){let t=e.match(/^(?:(\w+)\.)?(\w+)$/);if(t){let r=t[1],i=t[2],s=zjax&&zjax.userActions;if(r){if(!(s[r]&&s[r][i]))throw new Error(`Unknown action: ${r}.${i}`);return s[r][i].bind(s[r])}else{if(!s[i])throw new Error(`Unknown action: ${i}`);return s[i].bind(s)}}try{return new Function("$",e)}catch(r){throw new Error(`z-action value is invalid: ${r.message}`)}}window.zjax=y();document.addEventListener("DOMContentLoaded",()=>{l("Parsing DOM"),w(document),g(document);let e=Array.isArray(window.zjax.parseOn)?window.zjax.parseOn:[window.zjax.parseOn];for(let n of e)document.addEventListener(n,()=>{l("Reparsing DOM on",n),w(document),g(document)})});})();
