window.zjax=getGlobalZjaxObject();addEventListener("DOMContentLoaded",(function(){parseZSwaps()}));function getGlobalZjaxObject(){return{debug:false,actions:{},register:function(arg1,arg2){const namespace=arg2?arg1:null;const object=arg2?arg2:arg1;let actionsTarget;if(namespace){this.actions[namespace]={};actionsTarget=this.actions[namespace]}else{actionsTarget=this.actions}Object.keys(object).forEach((function(name){const handler=object[name];actionsTarget[name]=handler}))}}}function parseZSwaps(){document.querySelectorAll("[z-swap]").forEach((function(el){try{const valueString=collapseCommas(el.getAttribute("z-swap"));const valueParts=valueString.split(/\s/);if(valueParts.length<1||valueParts.length>4){throw new Error("Must have between 1 and 4 parts separated by spaces.")}const swapString=valueParts.pop()||null;const triggerString=valueParts[0]&&valueParts[0].startsWith("@")?valueParts.shift():null;const endpointString=valueParts.pop()||null;const methodString=valueParts.pop()||null;const zSwap={trigger:getTrigger(triggerString,el),method:getMethod(methodString,el),endpoint:getEndpoint(endpointString,el),swaps:getSwaps(swapString)};const zSwapFunction=getZSwapFunction(zSwap,el);attachEventListener(zSwap.trigger,zSwapFunction,el);attachMutationObserver(zSwap.trigger,zSwapFunction,el)}catch(error){console.error(`ZJAX ERROR – Unable to parse z-swap: ${error.message}\n`,el)}}))}function getTrigger(triggerString,el){if(triggerString){return triggerString.substr(1)}if(el.tagName==="FORM"){return"submit"}return"click"}function getMethod(methodString,el){if(methodString){const method=methodString.toUpperCase();if(!["GET","POST","PUT","PATCH","DELETE"].includes(method)){throw new Error(`Invalid method: ${method}`)}return method}if(el.tagName==="FORM"){return el.getAttribute("method")||"POST"}return"GET"}function getEndpoint(endpointString,el){if(["GET","POST","PUT","PATCH","DELETE"].includes(endpointString)){throw new Error("Missing required endpoint value.")}if(endpointString){return endpointString}if(el.tagName==="A"){return el.getAttribute("href")}if(el.tagName==="FORM"){return el.getAttribute("action")}throw new Error("Missing required endpoint value.")}function getSwaps(swapString){const swaps=[];swapString.split(",").forEach((function(swapPart){const swap={};const sourceAndTarget=swapPart.split("->");const targetAndSwapType=sourceAndTarget.pop();const[target,swapType]=targetAndSwapType.split("|");const source=sourceAndTarget[0]||target;swap["source"]=source;swap["target"]=target;swap["swapType"]=swapType||"outer";swaps.push(swap)}));return swaps}function getZSwapFunction(zSwap,el){return async function(event){event.preventDefault();event.stopPropagation();if(zjax.debug){console.log("zjax",zSwap,el)}try{const response=await fetch(zSwap.endpoint,{method:zSwap.method,body:null});if(!response.ok){return}const responseDOM=(new DOMParser).parseFromString(await response.text(),"text/html");zSwap.swaps.forEach((function(swap){const newNode=responseDOM.querySelector(swap.source);if(!newNode){throw new Error(`Source element ${swap.source} does not exist in response DOM`)}const existingNode=document.querySelector(swap.target);if(!existingNode){throw new Error(`Target element '${swap.target}' does not exist in local DOM`)}swapOneElement(existingNode,newNode,swap.swapType)}))}catch(error){console.error(`ZJAX ERROR – Unable to execute z-swap function: ${error.message}\n`,el)}}}function swapOneElement(existingNode,newNode,swapType){if(swapType==="outer"){existingNode.outerHTML=newNode.outerHTML;return}if(swapType==="inner"){existingNode.innerHTML=newNode.outerHTML;return}if(swapType==="before"){existingNode.parentNode.insertBefore(newNode,existingNode);return}if(swapType==="after"){existingNode.parentNode.insertBefore(newNode,existingNode.nextSibling);return}if(swapType==="prepend"){existingNode.insertBefore(newNode,existingNode.firstChild);return}if(swapType==="append"){existingNode.appendChild(newNode);return}if(swapType==="delete"){existingNode.remove();return}if(swapType==="none"){return}throw new Error(`Unknown swap type: ${swapType}`)}function attachEventListener(trigger,handler,el){el.addEventListener(trigger,handler)}function attachMutationObserver(trigger,handler,el){const observer=new MutationObserver((mutationsList=>{for(const mutation of mutationsList){for(const removedNode of mutation.removedNodes){if(removedNode===el||removedNode.contains(el)){el.removeEventListener(trigger,handler);console.log("Event listener removed because node is detached.");observer.disconnect();return}}}}));observer.observe(document.body,{childList:true,subtree:true})}function collapseCommas(str){return str.replace(/\s*,\s*/g,",")}