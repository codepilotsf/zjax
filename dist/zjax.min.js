(()=>{var $=Object.defineProperty;var v=(t,e)=>{for(var n in e)$(t,n,{get:e[n],enumerable:!0})};var l={};v(l,{attrsToNotFreeze:()=>R,httpMethods:()=>S,isVTSupported:()=>D,responseTypes:()=>j,swapTypes:()=>O});var S=["GET","POST","PUT","PATCH","DELETE"],j=["outer","inner"],O=["outer","inner","before","after","prepend","append","none","delete"],D=document.startViewTransition!==void 0,R=["id","z-swap","z-action","z-confirm","z-active","z-validate"];var f={};v(f,{attachMutationObserver:()=>P,getMatchingNodes:()=>C,getStatements:()=>F,prettyNodeName:()=>E});function C(t,e){let n=[];return n.push(...t.querySelectorAll(e)),!(t instanceof Document)&&t.matches(e)&&n.push(t),n}function F(t,e){let n=[],r=t.split(/,\s*(?=@)/);for(let o of r){let s=o.match(/^(@\w+|@\[[^\]]+\])?(.*)/),i=s[1]?s[1].replace(/@\[\s\]/):"",a=s[2]?s[2].trim():"",p=N(i,e);for(let c of p)n.push({trigger:c,handlerString:a})}return n}function N(t,e){return t?t.replace(/[@\[\s+\]]/g,"").split(","):e==="FORM"?["submit"]:["click"]}function E(t){return t instanceof Document?"#document":"<"+t.tagName.toLowerCase()+(t.id?"#"+t.id:"")+">"}function P(t,e,n){let r=new MutationObserver(o=>{for(let s of o)for(let i of s.removedNodes)if(i===n||i.contains(n)){n.removeEventListener(t,e),zjax.debug&&u(`Removing event listener for ${E(n)} (no longer in DOM)`),r.disconnect();return}});r.observe(document.body,{childList:!0,subtree:!0})}function y(){return{debug:!1,transitions:!0,zjaxActions:{},userActions:{},actions:function(t,e){let n=e?t:null;if(n==="zjax")throw new Error("'zjax' is a reserved actions namespace");let r=e||t,o;n?(this.userActions[n]={},o=this.userActions[n]):o=this.userActions;let s=Object.keys(r);for(let i of s){let a=r[i];o[i]=a}}}}function u(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}async function w(t){let e=f.getMatchingNodes(t,"[z-swap]");u(`Found ${e.length} z-swap nodes in ${f.prettyNodeName(t)}`);for(let n of e)try{let r=n.getAttribute("z-swap"),o=Z(r,n),s=q(o,n),i=o.trigger==="load"?"zjax:load":o.trigger;n.addEventListener(i,s),f.attachMutationObserver(i,s,n),i==="zjax:load"&&n.dispatchEvent(new CustomEvent("zjax:load")),u(`Added z-swap for '${o.trigger}' events to ${f.prettyNodeName(n)}`)}catch(r){console.error(`ZJAX ERROR \u2013 Unable to parse z-swap: ${r.message}
`,n,r.stack)}}function Z(t,e){let r=J(t).split(/\s/);if(r.length<1||r.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");let o={},s=[];for(;r.length>0;){let i=r.shift(),a=L(i);a?o[a[0]]=a[1]:s.push(i)}if(o.swaps=U(s.join(" ")),o.trigger||(o.trigger=e.tagName==="FORM"?"submit":"click"),o.method||(o.method=e.tagName==="FORM"?"POST":"GET"),!o.endpoint)if(e.tagName==="FORM")o.endpoint=e.action;else if(e.tagName==="A")o.endpoint=e.href;else throw new Error("No endpoint inferrable or specified");if(o.trigger==="submit"&&e.tagName!=="FORM")throw new Error("@submit trigger is only available on <FORM> elements");return o}function L(t){if(t.startsWith("@"))return["trigger",t.substr(1)];if(l.httpMethods.includes(t.toUpperCase()))return["method",t.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(t))return["endpoint",t]}function U(t){let e=[];for(let n of t.split(",")){let r={},o=n.split("->")||[],s=o.pop(),[i,a]=s.split("|"),p=o[0]||"",[c,d]=p?.split("|")||[null,null];if(r.response=c||i,r.target=i,r.responseType=d?.trim()||"outer",r.swapType=a?.trim()||"outer",r.responseType&&!l.responseTypes.includes(r.responseType))throw new Error(`Invalid swap type: ${r.responseType}`);if(r.swapType&&!l.swapTypes.includes(r.swapType))throw new Error(`Invalid swap type: ${r.swapType}`);if(r.response==="*"&&r.responseType!=="outer")throw new Error('Wild card "*" can not be piped to a Response Type');if(r.target==="*"&&r.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');e.push(r)}return e}function q(t,e){return async n=>{n.preventDefault(),n.stopPropagation();let r=e.tagName==="FORM"&&new FormData(n.target)||null;t.formData=r?V(r):null,u("z-swap triggered for",t);try{let o=new CustomEvent("zjax:request",{detail:{node:e,trigger:t.trigger,method:t.method,endpoint:t.endpoint,formData:t.formData}});document.dispatchEvent(o);let s=await k(t.method,t.endpoint,t.formData),i=s.body||s.documentElement,a=new CustomEvent("zjax:response",{detail:{node:e,response:i.innerHTML.replace(/\n|\s{2,}/g,"")}});document.dispatchEvent(a);for(let c of t.swaps){let d=document.querySelector(c.target);d&&d.classList.add("zjax-swapping");let[m,b]=I(s,c);u("Parsing incoming response for z-swaps"),m&&(w(m),h(m)),l.isVTSupported&&zjax.transitions?document.startViewTransition(()=>{x(b,m,c.swapType,c.responseType)}):x(b,m,c.swapType,c.responseType)}let p=new CustomEvent("zjax:swap",{detail:{node:e,swaps:t.swaps}});document.dispatchEvent(p)}catch(o){console.error(`ZJAX ERROR \u2013 Unable to execute z-swap function: ${o.message}
`,e,o.stack)}}}async function k(t,e,n){let r=await fetch(e,{method:t,body:n||null,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!r.ok)throw new Error(`${r.status} ${r.statusText} for ${e}`);let o=new DOMParser().parseFromString(await r.text(),"text/html");return u(`z-swap response from ${e} received and parsed`),o}function I(t,e){let n;if(e.target==="*"){if(n=document.querySelector("body"),!n)throw new Error("Unable to find body element in local DOM to swap into")}else n=document.querySelector(e.target);let r=e.response==="*"?t:t.querySelector(e.response);if(!n&&e.swapType!=="none")throw new Error(`Target node '${e.target}' does not exist in local DOM`);if(!r&&e.swapType!=="none"&&e.swapType!=="delete")throw new Error(`Source node ${e.response} does not exist in response DOM`);return[r,n]}function W(t,e){let n={},r=G(t,"[id]");for(let o of r)if(A(e,`[id="${o.id}"]`)){let i=T(o),a=T(e);M(e),z(e,i),n[o.id]=a}return[e,n]}function x(t,e,n,r){e=r==="inner"?e.childNodes:e;let o;[e,o]=W(t,e);let s=B(e);if(n==="outer"){let i=t.parentNode;for(let a of s)i.insertBefore(a,t);i.removeChild(t),g(e,o);return}if(n==="inner"){t.textContent="";for(let i of s)t.appendChild(i);g(e,o);return}if(n==="before"){for(let i of s)t.parentNode.insertBefore(i,t);g(e,o);return}if(n==="after"){let i=t.parentNode,a=t;for(let p of s)p===i.lastChild?i.appendChild(p):i.insertBefore(p,a.nextSibling),a=p;g(e,o);return}if(n==="prepend"){let i=t.firstChild;for(let a of s)i?t.insertBefore(a,i):t.appendChild(a);g(e,o);return}if(n==="append"){for(let i of s)t.appendChild(i);g(e,o);return}if(n==="delete"){t.remove();return}}function A(t,e){return t.matches(e)?t:t.querySelector(e)}function G(t,e){let n=[];return t.matches(e)&&n.push(t),n.push(...t.querySelectorAll(e)),n}function T(t){let e=[];for(let n of Array.from(t.attributes).filter(r=>!l.attrsToNotFreeze.includes(r.name)))e.push([n.name,n.value]);return e}function z(t,e){for(let[n,r]of e)t.setAttribute(n,r)}function M(t){for(let e of Array.from(t.attributes))l.attrsToNotFreeze.includes(e.name)||t.removeAttribute(e.name)}async function g(t,e){setTimeout(()=>{for(let[r,o]of Object.entries(e)){let s=A(t,`[id="${r}"]`);s&&(M(s),z(s,o))}let n=Object.keys(e).map(r=>`#${r}`).join(", ");if(n){let r=new CustomEvent("zjax:settle",{detail:{node:t,elementIds:n}});document.dispatchEvent(r)}},20)}function B(t){if(t instanceof Document){let e=t.querySelector("html");if(e)return Array.from(e.childNodes);let n=document.createDocumentFragment();for(let r of t.childNodes)n.appendChild(r);return Array.from(n.childNodes)}return t instanceof NodeList||Array.isArray(t)?Array.from(t):[t]}function J(t){return t.replace(/\s*,\s*/g,",")}function V(t){let e=new URLSearchParams;for(let[n,r]of t.entries())e.append(n,r);return e.toString()}function h(t){let e=f.getMatchingNodes(t,"[z-action]");u(`Found ${e.length} z-action nodes in ${f.prettyNodeName(t)}`);for(let n of e)try{let r=n.getAttribute("z-action"),o=f.getStatements(r,n.tagName);for(let{trigger:s,handlerString:i}of o){let a=H(i,n),p=X(n);n.addEventListener(s,async function(c){c.preventDefault(),c.stopPropagation();try{p.event=c;let d=await a(p),m=new CustomEvent("action",{detail:{result:d,event:c}});d&&n.dispatchEvent(m)}catch(d){console.error(`ZJAX ERROR \u2013 Unable to execute z-action: ${d.message}
`,n,d.stack)}}),f.attachMutationObserver(s,a,n),s==="load"&&n.dispatchEvent(new Event("load")),u(`Added z-action for '${s}' events to ${f.prettyNodeName(n)}`)}}catch(r){console.error(`ZJAX ERROR \u2013 Unable to parse z-action: ${r.message}
`,n,r.stack)}}function X(t){return new Proxy(function(){},{apply(e,n,r){if(r.length===0)return t;if(r.length===1){let o=document.querySelector(r[0]);if(!o)throw new Error(`$('${r[0]}') did not match any elements in the DOM.`);return o}throw new Error("$() can be called with a maximum of one argument.")},get(e,n){if(n==="event")return e.event;if(n==="all")return function(r){return document.querySelectorAll(r)}}})}function H(t,e){let n=t.match(/^(?:(\w+)\.)?(\w+)$/);if(n){let r=n[1],o=n[2],s=zjax&&zjax.userActions;if(r){if(!(s[r]&&s[r][o]))throw new Error(`Unknown action: ${r}.${o}`);return s[r][o].bind(s[r])}else{if(!s[o])throw new Error(`Unknown action: ${o}`);return s[o].bind(s)}}try{return new Function("$",t)}catch(r){throw new Error(`z-action value is invalid: ${r.message}`)}}window.zjax=y();document.addEventListener("DOMContentLoaded",()=>{u("Parsing DOM"),w(document),h(document);let t=Array.isArray(window.zjax.parseOn)?window.zjax.parseOn:[window.zjax.parseOn];for(let e of t)document.addEventListener(e,()=>{u("Reparsing DOM on",e),w(document),h(document)})});})();
