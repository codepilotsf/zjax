(()=>{var z=Object.defineProperty;var w=(e,t)=>{for(var n in t)z(e,n,{get:t[n],enumerable:!0})};var p={};w(p,{attrsToNotFreeze:()=>N,httpMethods:()=>M,isVTSupported:()=>O,responseTypes:()=>$,swapTypes:()=>S});var M=["GET","POST","PUT","PATCH","DELETE"],$=["outer","inner"],S=["outer","inner","before","after","prepend","append","none","delete"],O=document.startViewTransition!==void 0,N=["id","z-swap","z-action","z-confirm","z-active","z-validate"];var u={};w(u,{attachMutationObserver:()=>R,getMatchingNodes:()=>j,prettyNodeName:()=>b});function j(e,t){let n=[];return n.push(...e.querySelectorAll(t)),!(e instanceof Document)&&e.matches(t)&&n.push(e),n}function b(e){return e instanceof Document?"#document":"<"+e.tagName.toLowerCase()+(e.id?"#"+e.id:"")+">"}function R(e,t,n){let r=new MutationObserver(o=>{for(let i of o)for(let s of i.removedNodes)if(s===n||s.contains(n)){n.removeEventListener(e,t),zjax.debug&&c(`Removing event listener for ${b(n)} (no longer in DOM)`),r.disconnect();return}});r.observe(document.body,{childList:!0,subtree:!0})}function h(){return{debug:!1,transitions:!0,zjaxActions:{},userActions:{},actions:function(e,t){let n=t?e:null;if(n==="zjax")throw new Error("'zjax' is a reserved actions namespace");let r=t||e,o;n?(this.userActions[n]={},o=this.userActions[n]):o=this.userActions,Object.keys(r).forEach(function(i){let s=r[i];o[i]=s})}}}function c(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}async function l(e){let t=u.getMatchingNodes(e,"[z-swap]");c(`Found ${t.length} z-swap nodes in ${u.prettyNodeName(e)}`);for(let n of t)try{let r=n.getAttribute("z-swap"),o=D(r,n),i=P(o,n);n.addEventListener(o.trigger,i),u.attachMutationObserver(o.trigger,i,n),o.trigger==="load"&&n.dispatchEvent(new Event("load")),c(`Added z-swap for '${o.trigger}' events to ${u.prettyNodeName(n)}`)}catch(r){console.error(`ZJAX ERROR \u2013 Unable to parse z-swap: ${r.message}
`,n,r.stack)}}function D(e,t){let r=I(e).split(/\s/);if(r.length<1||r.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");let o={},i=[];for(;r.length>0;){let s=r.shift(),a=F(s);a?o[a[0]]=a[1]:i.push(s)}if(o.trigger==="@submit"&&t.tagName!=="FORM")throw new Error("@submit trigger is only available on <FORM> elements");if(o.swaps=C(i.join(" ")),o.trigger||(o.trigger=t.tagName==="FORM"?"submit":"click"),o.method||(o.method=t.tagName==="FORM"?"POST":"GET"),!o.endpoint)if(t.tagName==="FORM")o.endpoint=t.action;else if(t.tagName==="A")o.endpoint=t.href;else throw new Error("No endpoint inferrable or specified");return o}function F(e){if(e.startsWith("@"))return["trigger",e.substr(1)];if(p.httpMethods.includes(e.toUpperCase()))return["method",e.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(e))return["endpoint",e]}function C(e){let t=[];return e.split(",").forEach(function(n){let r={},o=n.split("->")||[],i=o.pop(),[s,a]=i.split("|"),f=o[0]||"",[x,m]=f&&f.split("|");if(r.response=x||s,r.target=s,r.responseType=m&&m.trim()||"outer",r.swapType=a&&a.trim()||"outer",r.responseType&&!p.responseTypes.includes(r.responseType))throw new Error(`Invalid swap type: ${r.responseType}`);if(r.swapType&&!p.swapTypes.includes(r.swapType))throw new Error(`Invalid swap type: ${r.swapType}`);if(r.response==="*"&&r.responseType!=="outer")throw new Error('Wild card "*" can notbe piped to a Response Type');if(r.target==="*"&&r.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');t.push(r)}),t}function P(e,t){return async function(n){n.preventDefault(),n.stopPropagation(),c("z-swap triggered for",e);try{let r=await Z(e.method,e.endpoint);e.swaps.forEach(function(o){let i=document.querySelector(o.target);i&&i.classList.add("zjax-swapping");let[s,a]=U(r,o);c("Parsing incoming response for z-swaps"),s&&l(s),p.isVTSupported&&zjax.transitions?document.startViewTransition(()=>{y(a,s,o.swapType,o.responseType)}):y(a,s,o.swapType,o.responseType)})}catch(r){console.error(`ZJAX ERROR \u2013 Unable to execute z-swap function: ${r.message}
`,t,r.stack)}}}async function Z(e,t){let n=await fetch(t,{method:e,body:null});if(!n.ok)throw new Error(`${n.status} ${n.statusText} for ${t}`);let r=new DOMParser().parseFromString(await n.text(),"text/html");return c(`z-swap response from ${t} received and parsed`),r}function U(e,t){let n,r;if(t.target==="*"){if(n=document.querySelector("body"),!n)throw new Error("Unable to find body element in local DOM to swap into")}else n=document.querySelector(t.target);if(r=t.response==="*"?e:e.querySelector(t.response),!n&&t.swapType!=="none")throw new Error(`Target node '${t.target}' does not exist in local DOM`);if(!r&&t.swapType!=="none"&&t.swapType!=="delete")throw new Error(`Source node ${t.response} does not exist in response DOM`);return[r,n]}function q(e,t){let n={},r=L(e,"[id]");for(let o of r)if(A(t,`[id="${o.id}"]`)){let s=T(o),a=T(t);v(t),E(t,s),n[o.id]=a}return[t,n]}function y(e,t,n,r){t=r==="inner"?t.childNodes:t;let o;[t,o]=q(e,t);let i=k(t);if(n==="outer"){let s=e.parentNode;i.forEach(a=>{s.insertBefore(a,e)}),s.removeChild(e),d(t,o);return}if(n==="inner"){e.textContent="",i.forEach(s=>{e.appendChild(s)}),d(t,o);return}if(n==="before"){i.forEach(s=>{e.parentNode.insertBefore(s,e)}),d(t,o);return}if(n==="after"){let s=e.parentNode;referenceNodeToAppendTo=e,i.forEach(a=>{a===s.lastChild?s.appendChild(a):s.insertBefore(a,referenceNodeToAppendTo.nextSibling),referenceNodeToAppendTo=a}),d(t,o);return}if(n==="prepend"){let s=e.firstChild;i.forEach(a=>{s?e.insertBefore(a,s):e.appendChild(a)}),d(t,o);return}if(n==="append"){i.forEach(s=>{e.appendChild(s)}),d(t,o);return}if(n==="delete"){e.remove();return}}function A(e,t){return e.matches(t)?e:e.querySelector(t)}function L(e,t){let n=[];return e.matches(t)&&n.push(e),n.push(...e.querySelectorAll(t)),n}function T(e){let t=[];for(let n of Array.from(e.attributes).filter(r=>!p.attrsToNotFreeze.includes(r.name)))t.push([n.name,n.value]);return t}function E(e,t){for(let[n,r]of t)e.setAttribute(n,r)}function v(e){Array.from(e.attributes).forEach(t=>{p.attrsToNotFreeze.includes(t.name)||e.removeAttribute(t.name)})}function d(e,t){setTimeout(()=>{for(let[n,r]of Object.entries(t)){let o=A(e,`[id="${n}"]`);o&&(v(o),E(o,r))}},20)}function k(e){if(e instanceof Document){let t=e.querySelector("html");if(t)return Array.from(t.childNodes);let n=document.createDocumentFragment();for(let r of e.childNodes)n.appendChild(r);return Array.from(n.childNodes)}return e instanceof NodeList||Array.isArray(e)?Array.from(e):[e]}function I(e){return e.replace(/\s*,\s*/g,",")}function g(e){let t=u.getMatchingNodes(e,"[z-action]");c(`Found ${t.length} z-action nodes in ${u.prettyNodeName(e)}`);for(let n of t)try{let r=n.getAttribute("z-action"),o=G(r,n),i=W(n);n.addEventListener(o.trigger,s=>{i.event=s,o.handler(i)}),u.attachMutationObserver(o.trigger,o.handler,n),o.trigger==="load"&&n.dispatchEvent(new Event("load")),c(`Added z-action for '${o.trigger}' events to ${u.prettyNodeName(n)}`)}catch(r){console.error(`ZJAX ERROR \u2013 Unable to parse z-action: ${r.message}
`,n,r.stack)}}function W(e){return new Proxy(function(){},{apply(t,n,r){if(r.length===0)return e;if(r.length===1)return document.querySelector(r[0]);throw new Error("$() can be called with a maximum of one argument.")},get(t,n){if(n==="event")return t.event;if(n==="all")return function(r){return document.querySelectorAll(r)}}})}function G(e,t){let n=e.match(/^\s*(?:@(\w+))?\s*(.*)/);if(!n)throw new Error("z-action value is invalid.");let r=n[1];r||(r=t.tagName==="FORM"?"submit":"click");let o=n[2],i=o.match(/^(?:(\w+)\.)?(\w+)$/);if(i){let s=i[1],a=i[2],f=zjax&&zjax.userActions;if(s){if(!(f[s]&&f[s][a]))throw new Error(`Unknown action: ${s}.${a}`);return{trigger:r,handler:f[s][a]}}else{if(!f[a])throw new Error(`Unknown action: ${a}`);return{trigger:r,handler:f[a]}}}try{return{trigger:r,handler:new Function("$","return "+o)}}catch(s){throw new Error(`z-action value is invalid: ${s.message}`)}}window.zjax=h();addEventListener("DOMContentLoaded",function(){c("Parsing DOM"),l(document),g(document)});})();
