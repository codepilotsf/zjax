(()=>{var S=Object.defineProperty;var v=(e,t)=>{for(var n in t)S(e,n,{get:t[n],enumerable:!0})};var u={};v(u,{attrsToNotFreeze:()=>k,globalTriggerModifiers:()=>R,httpMethods:()=>$,isVTSupported:()=>D,keyboardEvents:()=>F,keyboardTriggerModifiers:()=>Z,mouseEvents:()=>C,mouseTriggerModifiers:()=>P,responseTypes:()=>j,swapTypes:()=>O,timerTriggerModifiers:()=>N});var $=["GET","POST","PUT","PATCH","DELETE"],j=["outer","inner"],O=["outer","inner","before","after","prepend","append","none","delete"],D=document.startViewTransition!==void 0,k=["id","z-swap","z-action","z-confirm","z-active","z-validate"],R=["document","window","once","prevent","stop"],N=["delay","debounce","throttle"],C=["click","auxclick","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","mouseenter","mouseleave","context"],P=["outside","ctrl","shift","alt","cmd","meta"],F=["keydown","keyup","keypress","input","change","focus","blur"],Z=["keyName","shift","alt","ctrl","meta","cmd"];var f={};v(f,{attachMutationObserver:()=>W,getMatchingNodes:()=>U,getStatements:()=>L,prettyNodeName:()=>x});function U(e,t){let n=[];return n.push(...e.querySelectorAll(t)),!(e instanceof Document)&&e.matches(t)&&n.push(e),n}function L(e,t){let n=[],o=e.split(/,\s*(?=@)/);for(let s of o){let r=s.match(/^(@\w+[\w\-\.]+|@\[[\w\-\.\,]+\])?(.*)/),i=r[1]?r[1].replace(/[@\[\]\s]+/,""):"",a=r[2]?r[2].trim():"",c=q(i,t);for(let{trigger:d,modifiers:l}of c)n.push({trigger:d,modifiers:l,handlerString:a})}return n}function q(e,t){if(!e)return t==="FORM"?[{trigger:"submit"}]:[{trigger:"click"}];let n=[];for(let o of e.split(","))n.push(I(o));return n}function I(e){let t=e.split("."),n=t.shift(),o=u.mouseEvents.includes(n),s=u.keyboardEvents.includes(n),r=s?"keyName":null;for(let i of t){if(previousModifier=i,u.globalTriggerModifiers.includes(i)){t[i]=!0;continue}if(o&&u.mouseTriggerModifiers.includes(i)){t[i]=!0;continue}if(s&&u.keyboardTriggerModifiers.includes(i)){t[i]=!0;continue}if(s&&r==="keyName"){t[r]=i,r=null;continue}if(u.timerTriggerModifiers.includes(i)){r=i;continue}if(r&&u.timerTriggerModifiers.includes(r)){let a=i.match(/\d+s/),c=i.match(/\d+ms/);if(!a&&!c)throw new Error(`Invalid timer value: ${i}`);t[r]=a?parseInt(a[0])*1e3:parseInt(c[0]),r=null;continue}throw new Error(`Unknown trigger modifier in this context: ${i}`)}return{trigger:n,modifiers:t}}function x(e){return e instanceof Document?"#document":"<"+e.tagName.toLowerCase()+(e.id?"#"+e.id:"")+">"}function W(e,t,n){let o=new MutationObserver(s=>{for(let r of s)for(let i of r.removedNodes)if(i===n||i.contains(n)){n.removeEventListener(e,t),zjax.debug&&p(`Removing event listener for ${x(n)} (no longer in DOM)`),o.disconnect();return}});o.observe(document.body,{childList:!0,subtree:!0})}function b(){return{debug:!1,transitions:!0,zjaxActions:{},userActions:{},actions:function(e,t){let n=t?e:null;if(n==="zjax")throw new Error("'zjax' is a reserved actions namespace");let o=t||e,s;n?(this.userActions[n]={},s=this.userActions[n]):s=this.userActions;let r=Object.keys(o);for(let i of r){let a=o[i];s[i]=a}}}}function p(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}async function w(e){let t=f.getMatchingNodes(e,"[z-swap]");p(`Found ${t.length} z-swap nodes in ${f.prettyNodeName(e)}`);for(let n of t)try{let o=n.getAttribute("z-swap"),s=f.getStatements(o,n.tagName);for(let{trigger:r,modifiers:i,handlerString:a}of s){let c=G(r,a,n),d=V(c,n);c.trigger=c.trigger==="load"?"zjax:load":c.trigger,n.addEventListener(c.trigger,d),f.attachMutationObserver(c.trigger,d,n),r==="zjax:load"&&n.dispatchEvent(new CustomEvent("zjax:load")),p(`Added z-swap for '${c.trigger}' events to ${f.prettyNodeName(n)}`)}}catch(o){console.error(`ZJAX ERROR \u2013 Unable to parse z-swap: ${o.message}
`,n,o.stack)}}function G(e,t,n){let s=Y(t).split(/\s/);if(s.length<1||s.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");let r={trigger:e},i=[];for(;s.length>0;){let a=s.shift(),c=B(a);c?r[c[0]]=c[1]:i.push(a)}if(r.swaps=J(i.join(" ")),r.method||(r.method=n.tagName==="FORM"?"POST":"GET"),!r.endpoint)if(n.tagName==="FORM")r.endpoint=n.action;else if(n.tagName==="A")r.endpoint=n.href;else throw new Error("No endpoint inferrable or specified");return r}function B(e){if(u.httpMethods.includes(e.toUpperCase()))return["method",e.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(e))return["endpoint",e]}function J(e){let t=[];for(let n of e.split(",")){let o={},s=n.split("->")||[],r=s.pop(),[i,a]=r.split("|"),c=s[0]||"",[d,l]=c?.split("|")||[null,null];if(o.response=d||i,o.target=i,o.responseType=l?.trim()||"outer",o.swapType=a?.trim()||"outer",o.responseType&&!u.responseTypes.includes(o.responseType))throw new Error(`Invalid swap type: ${o.responseType}`);if(o.swapType&&!u.swapTypes.includes(o.swapType))throw new Error(`Invalid swap type: ${o.swapType}`);if(o.response==="*"&&o.responseType!=="outer")throw new Error('Wild card "*" can not be piped to a Response Type');if(o.target==="*"&&o.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');t.push(o)}return t}function V(e,t){return async n=>{n.preventDefault(),n.stopPropagation();let o=t.tagName==="FORM"&&new FormData(n.target)||null;e.formData=o?ee(o):null,p("z-swap triggered for",e);try{let s=new CustomEvent("zjax:request",{detail:{node:t,trigger:e.trigger,method:e.method,endpoint:e.endpoint,formData:e.formData}});document.dispatchEvent(s);let r=await X(e.method,e.endpoint,e.formData),i=r.body||r.documentElement,a=new CustomEvent("zjax:response",{detail:{node:t,response:i.innerHTML.replace(/\n|\s{2,}/g,"")}});document.dispatchEvent(a);for(let d of e.swaps){let l=document.querySelector(d.target);l&&l.classList.add("zjax-swapping");let[m,y]=H(r,d);p("Parsing incoming response for z-swaps"),m&&(w(m),h(m)),u.isVTSupported&&zjax.transitions?document.startViewTransition(()=>{E(y,m,d.swapType,d.responseType)}):E(y,m,d.swapType,d.responseType)}let c=new CustomEvent("zjax:swap",{detail:{node:t,swaps:e.swaps}});document.dispatchEvent(c)}catch(s){console.error(`ZJAX ERROR \u2013 Unable to execute z-swap function: ${s.message}
`,t,s.stack)}}}async function X(e,t,n){let o=await fetch(t,{method:e,body:n||null,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!o.ok)throw new Error(`${o.status} ${o.statusText} for ${t}`);let s=new DOMParser().parseFromString(await o.text(),"text/html");return p(`z-swap response from ${t} received and parsed`),s}function H(e,t){let n;if(t.target==="*"){if(n=document.querySelector("body"),!n)throw new Error("Unable to find body element in local DOM to swap into")}else n=document.querySelector(t.target);let o=t.response==="*"?e:e.querySelector(t.response);if(!n&&t.swapType!=="none")throw new Error(`Target node '${t.target}' does not exist in local DOM`);if(!o&&t.swapType!=="none"&&t.swapType!=="delete")throw new Error(`Source node ${t.response} does not exist in response DOM`);return[o,n]}function K(e,t){let n={},o=_(e,"[id]");for(let s of o)if(A(t,`[id="${s.id}"]`)){let i=T(s),a=T(t);z(t),M(t,i),n[s.id]=a}return[t,n]}function E(e,t,n,o){t=o==="inner"?t.childNodes:t;let s;[t,s]=K(e,t);let r=Q(t);if(n==="outer"){let i=e.parentNode;for(let a of r)i.insertBefore(a,e);i.removeChild(e),g(t,s);return}if(n==="inner"){e.textContent="";for(let i of r)e.appendChild(i);g(t,s);return}if(n==="before"){for(let i of r)e.parentNode.insertBefore(i,e);g(t,s);return}if(n==="after"){let i=e.parentNode,a=e;for(let c of r)c===i.lastChild?i.appendChild(c):i.insertBefore(c,a.nextSibling),a=c;g(t,s);return}if(n==="prepend"){let i=e.firstChild;for(let a of r)i?e.insertBefore(a,i):e.appendChild(a);g(t,s);return}if(n==="append"){for(let i of r)e.appendChild(i);g(t,s);return}if(n==="delete"){e.remove();return}}function A(e,t){return e.matches(t)?e:e.querySelector(t)}function _(e,t){let n=[];return e.matches(t)&&n.push(e),n.push(...e.querySelectorAll(t)),n}function T(e){let t=[];for(let n of Array.from(e.attributes).filter(o=>!u.attrsToNotFreeze.includes(o.name)))t.push([n.name,n.value]);return t}function M(e,t){for(let[n,o]of t)e.setAttribute(n,o)}function z(e){for(let t of Array.from(e.attributes))u.attrsToNotFreeze.includes(t.name)||e.removeAttribute(t.name)}async function g(e,t){setTimeout(()=>{for(let[o,s]of Object.entries(t)){let r=A(e,`[id="${o}"]`);r&&(z(r),M(r,s))}let n=Object.keys(t).map(o=>`#${o}`).join(", ");if(n){let o=new CustomEvent("zjax:settle",{detail:{node:e,elementIds:n}});document.dispatchEvent(o)}},20)}function Q(e){if(e instanceof Document){let t=e.querySelector("html");if(t)return Array.from(t.childNodes);let n=document.createDocumentFragment();for(let o of e.childNodes)n.appendChild(o);return Array.from(n.childNodes)}return e instanceof NodeList||Array.isArray(e)?Array.from(e):[e]}function Y(e){return e.replace(/\s*,\s*/g,",")}function ee(e){let t=new URLSearchParams;for(let[n,o]of e.entries())t.append(n,o);return t.toString()}function h(e){let t=f.getMatchingNodes(e,"[z-action]");p(`Found ${t.length} z-action nodes in ${f.prettyNodeName(e)}`);for(let n of t)try{let o=n.getAttribute("z-action"),s=f.getStatements(o,n.tagName);for(let{trigger:r,modifiers:i,handlerString:a}of s){let c=ne(a,n),d=te(n);n.addEventListener(r,async function(l){l.preventDefault(),l.stopPropagation();try{d.event=l;let m=await c(d),y=new CustomEvent("action",{detail:{result:m,event:l}});m&&n.dispatchEvent(y)}catch(m){console.error(`ZJAX ERROR \u2013 Unable to execute z-action: ${m.message}
`,n,m.stack)}}),f.attachMutationObserver(r,c,n),r==="load"&&n.dispatchEvent(new Event("load")),p(`Added z-action for '${r}' events to ${f.prettyNodeName(n)}`)}}catch(o){console.error(`ZJAX ERROR \u2013 Unable to parse z-action: ${o.message}
`,n,o.stack)}}function te(e){return new Proxy(function(){},{apply(t,n,o){if(o.length===0)return e;if(o.length===1){let s=document.querySelector(o[0]);if(!s)throw new Error(`$('${o[0]}') did not match any elements in the DOM.`);return s}throw new Error("$() can be called with a maximum of one argument.")},get(t,n){if(n==="event")return t.event;if(n==="all")return function(o){return document.querySelectorAll(o)}}})}function ne(e,t){let n=e.match(/^(?:(\w+)\.)?(\w+)$/);if(n){let o=n[1],s=n[2],r=zjax&&zjax.userActions;if(o){if(!(r[o]&&r[o][s]))throw new Error(`Unknown action: ${o}.${s}`);return r[o][s].bind(r[o])}else{if(!r[s])throw new Error(`Unknown action: ${s}`);return r[s].bind(r)}}try{return new Function("$",e)}catch(o){throw new Error(`z-action value is invalid: ${o.message}`)}}window.zjax=b();document.addEventListener("DOMContentLoaded",()=>{p("Parsing DOM"),w(document),h(document);let e=Array.isArray(window.zjax.parseOn)?window.zjax.parseOn:[window.zjax.parseOn];for(let t of e)document.addEventListener(t,()=>{p("Reparsing DOM on",t),w(document),h(document)})});})();
