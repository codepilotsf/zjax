(function(){"use strict";const R=["GET","POST","PUT","PATCH","DELETE"],C=["outer","inner"],L=["outer","inner","before","after","prepend","append","none","delete"],U=document.startViewTransition!==void 0,b=["id","z-swap","z-action","z-confirm","z-active","z-validate"],q=["document","window","once","prevent","stop"],v=["delay","debounce"],A=["click","auxclick","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","mouseenter","mouseleave","context"],I=["ctrl","shift","alt","meta"],E=["keydown","keyup"],K=["keyName","ctrl","shift","alt","meta"],N={enter:"Enter",escape:"Escape",tab:"Tab",backspace:"Backspace",delete:"Delete",insert:"Insert",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",arrowup:"ArrowUp",arrowdown:"ArrowDown",arrowleft:"ArrowLeft",arrowright:"ArrowRight",space:" ",comma:",",period:".",semicolon:";",singlequote:"'",doublequote:'"',backtick:"`",slash:"/",backslash:"\\",bracketleft:"[",bracketright:"]",curlybracketleft:"{",curlybracketright:"}",minus:"-",equal:"=",plus:"+",underscore:"_",ampersand:"&",asterisk:"*",at:"@",dollar:"$",percent:"%",caret:"^",exclamation:"!",tilde:"~",pipe:"|",colon:":",question:"?",underscore:"_",lessthan:"<",greaterthan:">",hash:"#"};function W(e,t){return!(E.includes(e.event)&&(e.modifiers.shift&&!t.shiftKey||e.modifiers.ctrl&&!t.ctrlKey||e.modifiers.alt&&!t.altKey||e.modifiers.meta&&!t.metaKey||e.modifiers.keyName&&t.key!==e.modifiers.keyName&&e.modifiers.keyName!=="any"))}function B(e,t){return!(A.includes(e.event)&&(e.modifiers.shift&&!t.shiftKey||e.modifiers.ctrl&&!t.ctrlKey||e.modifiers.alt&&!t.altKey||e.modifiers.meta&&!t.metaKey))}function Z(e,t){return!(e.modifiers.outside&&e.node.contains(t.target))}function G(e){return e.node.hasFiredOnce?!1:(e.modifiers.once&&(e.node.hasFiredOnce=!0),!0)}function H(e,t){return e.modifiers.prevent&&t.preventDefault(),e.modifiers.stop&&t.stopPropagation(),!0}async function J(e){return e.modifiers.delay&&await new Promise(t=>setTimeout(t,e.modifiers.delay)),!0}function T(e,t){let n;return function(...o){const r=this;clearTimeout(n),n=setTimeout(()=>{e.apply(r,o)},t)}}function $(e,t){const n=[];return n.push(...e.querySelectorAll(t)),!(e instanceof Document)&&e.matches(t)&&n.push(e),n}function m(e){return e instanceof Document?"#document":"<"+e.tagName.toLowerCase()+(e.id?"#"+e.id:"")+">"}function V(){return{debug:!1,transitions:!0,parse:function(){w(document),y(document)},zjaxActions:{},userActions:{},actions:function(e,t){const n=t?e:null;if(n==="zjax")throw new Error("'zjax' is a reserved actions namespace");const o=t||e;let r;n?(this.userActions[n]={},r=this.userActions[n]):r=this.userActions;const i=Object.keys(o);for(const s of i){const a=o[s];r[s]=a}}}}function u(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}function X(e,t){const n=new Proxy(function(){},{apply(o,r,i){if(i.length===0)return e;if(i.length===1){const s=document.querySelector(i[0]);if(!s)throw new Error(`$('${i[0]}') did not match any elements in the DOM.`);return s}throw new Error("$() can be called with a maximum of one argument.")},get(o,r){if(r==="event")return o.event;if(r==="all")return function(i){return document.querySelectorAll(i)};if(r==="redirect")return function(i){window.location=i}}});return n.event=t,n}function M(e,t){const n=[],o=e.split(/,\s*(?=@)/);for(const r of o){const i=r.match(/^(@\w+[\w\-\.]+|@\[[\w\-\.\,\s]+\])?(.*)/),s=i[1]?i[1].replace(/[@\[\]\s]/g,""):"",a=i[2]?i[2].trim():"";if(!s)throw new Error(`Missing @<trigger> string in "${r}"`);const c=s.split(",");for(const l of c){const p=l.split("."),P=p.shift(),j=_(P,p),g=Object.keys(j);let h;g.includes("document")?h=document:g.includes("window")||g.includes("outside")?h=window:h=t,n.push({event:P,modifiers:j,target:h,node:t,handlerString:a})}}return n}function _(e,t){const n=A.includes(e),o=E.includes(e),r={};let i=o?"keyName":null;for(const s of t){if(q.includes(s)){r[s]=!0;continue}if(n&&I.includes(s)){r[s]=!0;continue}if(o&&K.includes(s)){r[s]=!0;continue}if(s==="once"){r[s]=!0;continue}if(s==="outside"&&(n||o)){r[s]=!0;continue}if(o&&i==="keyName"){r[i]=N[s]||s,i=null;continue}if(v.includes(s)){i=s;continue}if(i&&v.includes(i)){const a=s.match(/\d+s/),c=s.match(/\d+ms/);if(!a&&!c)throw new Error(`Invalid timer value: ${s}`);r[i]=a?parseInt(a[0])*1e3:parseInt(c[0]),i=null;continue}throw new Error(`Unknown trigger modifier in this context: ${s}`)}return r}let k=0;const f={};function z(e,t,n=!1){k++;const o=`handler${k}`,r=e.event==="mount"?`mount:${o}`:e.event;f[o]={target:e.target,event:r,handlerFunction:async function(i){if(!W(e,i)||!B(e,i)||!Z(e,i)||!G(e)||(H(e,i),!await J(e)))return;const s=n?X(e.node,i):i;if(T){T(t,e.modifiers.debounce)(s);return}await t(s)}},e.target.addEventListener(r,f[o].handlerFunction),Y(e,o),e.event==="mount"&&e.target.dispatchEvent(new Event(r))}function Q(){u("Removing all zjax event listeners");for(const e in f){const t=f[e];t.target.removeEventListener(t.event,t.handlerFunction),delete f[e]}}function Y(e,t){const n=new MutationObserver(o=>{for(const r of o)for(const i of r.removedNodes)if(i===e.node||i.contains(e.node)){f[t]&&e.target.removeEventListener(e.event,f[t].handlerFunction),delete f[t],zjax.debug&&u(`Removing event listener for ${m(e.node)} (no longer in DOM)`),n.disconnect();return}});n.observe(document,{childList:!0,subtree:!0})}async function w(e){const t=$(e,"[z-swap]");u(`Found ${t.length} z-swap nodes in ${m(e)}`);for(const n of t)try{const o=n.getAttribute("z-swap"),r=M(o,n);for(const i of r){const s=ee(i),a=oe(i,s);z(i,a,!0),u(`Added z-swap for '${i.event}' events to ${m(n)}`)}}catch(o){console.error(`ZJAX ERROR – Unable to parse z-swap: ${o.message}
`,n,o.stack)}}function ee({handlerString:e,node:t}){e=ue(e);const n=e.split(/\s/);if(n.length<1||n.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");const o={},r=[];for(;n.length>0;){const i=n.shift(),s=te(i);s?o[s[0]]=s[1]:r.push(i)}if(o.swaps=ne(r.join(" ")),o.method||(o.method=t.tagName==="FORM"&&t.method?t.method:"GET"),!o.endpoint)if(t.tagName==="FORM")o.endpoint=t.action;else if(t.tagName==="A")o.endpoint=t.href;else throw new Error("No endpoint inferrable or specified");return o}function te(e){if(R.includes(e.toUpperCase()))return["method",e.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(e))return["endpoint",e]}function ne(e){const t=[];for(const n of e.split(",")){const o={},r=n.split("->")||[],i=r.pop(),[s,a]=i.split("|"),c=r[0]||"",[l,p]=(c==null?void 0:c.split("|"))||[null,null];if(o.response=l||s,o.target=s,o.responseType=(p==null?void 0:p.trim())||"outer",o.swapType=(a==null?void 0:a.trim())||"outer",o.responseType&&!C.includes(o.responseType))throw new Error(`Invalid swap type: ${o.responseType}`);if(o.swapType&&!L.includes(o.swapType))throw new Error(`Invalid swap type: ${o.swapType}`);if(o.response==="*"&&o.responseType!=="outer")throw new Error('Wild card "*" can not be piped to a Response Type');if(o.target==="*"&&o.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');t.push(o)}return t}function oe(e,t){return async n=>{const o=e.node.tagName==="FORM"&&new FormData(n.target)||null;t.formData=o?fe(o):null,u("z-swap triggered for",t);try{const r=await re(t.method,t.endpoint,t.formData),i=r.body||r.documentElement;for(const s of t.swaps){const a=document.querySelector(s.target);a&&a.classList.add("zjax-swapping");const[c,l]=se(r,s);u("Parsing incoming response for z-swaps"),c&&(w(c),y(c)),U&&zjax.transitions?document.startViewTransition(()=>{x(l,c,s.swapType,s.responseType)}):x(l,c,s.swapType,s.responseType)}}catch(r){console.error(`ZJAX ERROR – Unable to execute z-swap function: ${r.message}
`,e.node,r.stack)}}}async function re(e,t,n){const o=await fetch(t,{method:e,body:n||null,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!o.ok)throw new Error(`${o.status} ${o.statusText} for ${t}`);const r=new DOMParser().parseFromString(await o.text(),"text/html");return u(`z-swap response from ${t} received and parsed`),r}function se(e,t){let n;if(t.target==="*"){if(n=document.querySelector("body"),!n)throw new Error("Unable to find body element in local DOM to swap into")}else n=document.querySelector(t.target);const o=t.response==="*"?e:e.querySelector(t.response);if(!n&&t.swapType!=="none")throw new Error(`Target node '${t.target}' does not exist in local DOM`);if(!o&&t.swapType!=="none"&&t.swapType!=="delete")throw new Error(`Source node ${t.response} does not exist in response DOM`);return[o,n]}function ie(e,t){const n={},o=ae(e,"[id]");for(const r of o)if(D(t,`[id="${r.id}"]`)){const s=S(r),a=S(t);O(t),F(t,s),n[r.id]=a}return[t,n]}function x(e,t,n,o){t=o==="inner"?t.childNodes:t;let r;[t,r]=ie(e,t);const i=ce(t);if(n==="outer"){const s=e.parentNode;for(const a of i)s.insertBefore(a,e);s.removeChild(e),d(t,r);return}if(n==="inner"){e.textContent="";for(const s of i)e.appendChild(s);d(t,r);return}if(n==="before"){for(const s of i)e.parentNode.insertBefore(s,e);d(t,r);return}if(n==="after"){const s=e.parentNode;let a=e;for(const c of i)c===s.lastChild?s.appendChild(c):s.insertBefore(c,a.nextSibling),a=c;d(t,r);return}if(n==="prepend"){const s=e.firstChild;for(const a of i)s?e.insertBefore(a,s):e.appendChild(a);d(t,r);return}if(n==="append"){for(const s of i)e.appendChild(s);d(t,r);return}if(n==="delete"){e.remove();return}}function D(e,t){return e.matches(t)?e:e.querySelector(t)}function ae(e,t){const n=[];return e.matches(t)&&n.push(e),n.push(...e.querySelectorAll(t)),n}function S(e){const t=[];for(const n of Array.from(e.attributes).filter(o=>!b.includes(o.name)))t.push([n.name,n.value]);return t}function F(e,t){for(const[n,o]of t)e.setAttribute(n,o)}function O(e){for(const t of Array.from(e.attributes))b.includes(t.name)||e.removeAttribute(t.name)}async function d(e,t){setTimeout(()=>{for(const[n,o]of Object.entries(t)){const r=D(e,`[id="${n}"]`);r&&(O(r),F(r,o))}Object.keys(t).map(n=>`#${n}`).join(", ")},20)}function ce(e){if(e instanceof Document){const t=e.querySelector("html");if(t)return Array.from(t.childNodes);const n=document.createDocumentFragment();for(const o of e.childNodes)n.appendChild(o);return Array.from(n.childNodes)}return e instanceof NodeList||Array.isArray(e)?Array.from(e):[e]}function ue(e){return e.replace(/\s*,\s*/g,",")}function fe(e){const t=new URLSearchParams;for(const[n,o]of e.entries())t.append(n,o);return t.toString()}function y(e){const t=$(e,"[z-action]");u(`Found ${t.length} z-action nodes in ${m(e)}`);for(const n of t)try{const o=n.getAttribute("z-action"),r=M(o,n);for(const i of r){const s=de(i);n.handlerId=z(i,s,!0),u(`Added z-action for '${i.event}' events to ${m(n)}`)}}catch(o){console.error(`ZJAX ERROR – Unable to parse z-action: ${o.message}
`,n,o.stack)}}function de(e){return async function(t){await le(e)(t)}}function le({handlerString:e}){const t=e.match(/^(?:(\w+)\.)?(\w+)$/);if(t){const n=t[1],o=t[2],r=zjax&&zjax.userActions;if(n){if(!(r[n]&&r[n][o]))throw new Error(`Unknown action: ${n}.${o}`);return r[n][o].bind(r[n])}else{if(!r[o])throw new Error(`Unknown action: ${o}`);return r[o].bind(r)}}try{return new Function("$",e)}catch(n){throw new Error(`z-action value is invalid: ${n.message}`)}}window.zjax=V(),document.addEventListener("DOMContentLoaded",()=>{u("Parsing DOM on document load"),w(document),y(document)}),document.addEventListener("turbo:load",()=>{u("Parsing DOM on turbo:load"),Q(),w(document),y(document)})})();
