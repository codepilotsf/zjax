(function(){"use strict";const j=["GET","POST","PUT","PATCH","DELETE"],R=["outer","inner"],C=["outer","inner","before","after","prepend","append","none","delete"],F=document.startViewTransition!==void 0,g=["id","z-swap","z-action","z-confirm","z-active","z-validate"],U=["document","window","once","prevent","stop"],b=["delay","debounce"],v=["click","auxclick","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","mouseenter","mouseleave","context"],q=["ctrl","shift","alt","meta"],A=["keydown","keyup"],L=["keyName","ctrl","shift","alt","meta"],I={enter:"Enter",escape:"Escape",tab:"Tab",backspace:"Backspace",delete:"Delete",insert:"Insert",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",arrowup:"ArrowUp",arrowdown:"ArrowDown",arrowleft:"ArrowLeft",arrowright:"ArrowRight",space:" ",comma:",",period:".",semicolon:";",singlequote:"'",doublequote:'"',backtick:"`",slash:"/",backslash:"\\",bracketleft:"[",bracketright:"]",curlybracketleft:"{",curlybracketright:"}",minus:"-",equal:"=",plus:"+",underscore:"_",ampersand:"&",asterisk:"*",at:"@",dollar:"$",percent:"%",caret:"^",exclamation:"!",tilde:"~",pipe:"|",colon:":",question:"?",underscore:"_",lessthan:"<",greaterthan:">",hash:"#"};function K(e,t){return!(A.includes(e.event)&&(e.modifiers.shift&&!t.shiftKey||e.modifiers.ctrl&&!t.ctrlKey||e.modifiers.alt&&!t.altKey||e.modifiers.meta&&!t.metaKey||e.modifiers.keyName&&t.key!==e.modifiers.keyName))}function N(e,t){return!(v.includes(e.event)&&(e.modifiers.shift&&!t.shiftKey||e.modifiers.ctrl&&!t.ctrlKey||e.modifiers.alt&&!t.altKey||e.modifiers.meta&&!t.metaKey))}function W(e,t){return!(e.modifiers.outside&&e.node.contains(t.target))}function B(e){return e.node.hasFiredOnce?!1:(e.modifiers.once&&(e.node.hasFiredOnce=!0),!0)}function Z(e,t){return e.modifiers.prevent&&t.preventDefault(),e.modifiers.stop&&t.stopPropagation(),!0}async function G(e){return e.modifiers.delay&&await new Promise(t=>setTimeout(t,e.modifiers.delay)),!0}function T(e,t){let n;return function(...o){const r=this;clearTimeout(n),n=setTimeout(()=>{e.apply(r,o)},t)}}function E(e,t){const n=[];return n.push(...e.querySelectorAll(t)),!(e instanceof Document)&&e.matches(t)&&n.push(e),n}function p(e){return e instanceof Document?"#document":"<"+e.tagName.toLowerCase()+(e.id?"#"+e.id:"")+">"}function H(e,t,n){const o=new MutationObserver(r=>{for(const i of r)for(const s of i.removedNodes)if(s===n||s.contains(n)){n.removeEventListener(e,t),zjax.debug&&u(`Removing event listener for ${p(n)} (no longer in DOM)`),o.disconnect();return}});o.observe(document.body,{childList:!0,subtree:!0})}function J(){return{debug:!1,transitions:!0,zjaxActions:{},userActions:{},actions:function(e,t){const n=t?e:null;if(n==="zjax")throw new Error("'zjax' is a reserved actions namespace");const o=t||e;let r;n?(this.userActions[n]={},r=this.userActions[n]):r=this.userActions;const i=Object.keys(o);for(const s of i){const a=o[s];r[s]=a}}}}function u(){window.zjax&&window.zjax.debug&&console.log("ZJAX DEBUG:",...arguments)}function z(e,t){const n=[],o=e.split(/,\s*(?=@)/);for(const r of o){const i=r.match(/^(@\w+[\w\-\.]+|@\[[\w\-\.\,\s]+\])?(.*)/),s=i[1]?i[1].replace(/[@\[\]\s]/g,""):"",a=i[2]?i[2].trim():"";if(!s){const f=t.tagName==="FORM"?"submit":"click";n.push({event:f,modifiers:{},node:t,target:t,handlerString:a});continue}const c=s.split(",");for(const f of c){const l=f.split("."),S=l.shift(),P=V(S,l),y=Object.keys(P);let m;y.includes("document")?m=document:y.includes("window")||y.includes("outside")?m=window:m=t,n.push({event:S,modifiers:P,target:m,node:t,handlerString:a})}}return n}function V(e,t){const n=v.includes(e),o=A.includes(e),r={};let i=o?"keyName":null;for(const s of t){if(U.includes(s)){r[s]=!0;continue}if(n&&q.includes(s)){r[s]=!0;continue}if(o&&L.includes(s)){r[s]=!0;continue}if(s==="once"){r[s]=!0;continue}if(s==="outside"&&(n||o)){r[s]=!0;continue}if(o&&i==="keyName"){r[i]=I[s]||s,i=null;continue}if(b.includes(s)){i=s;continue}if(i&&b.includes(i)){const a=s.match(/\d+s/),c=s.match(/\d+ms/);if(!a&&!c)throw new Error(`Invalid timer value: ${s}`);r[i]=a?parseInt(a[0])*1e3:parseInt(c[0]),i=null;continue}throw new Error(`Unknown trigger modifier in this context: ${s}`)}return r}function M(e,t,n=!1){e.target.addEventListener(e.event,async function(o){if(!K(e,o)||!N(e,o)||!W(e,o)||!B(e)||(Z(e,o),!await G(e)))return;const r=n?X(e.node,o):o;if(T){T(t,e.modifiers.debounce)(r);return}await t(r)}),H(e.event,t,e.node)}function X(e,t){const n=new Proxy(function(){},{apply(o,r,i){if(i.length===0)return e;if(i.length===1){const s=document.querySelector(i[0]);if(!s)throw new Error(`$('${i[0]}') did not match any elements in the DOM.`);return s}throw new Error("$() can be called with a maximum of one argument.")},get(o,r){if(r==="event")return o.event;if(r==="all")return function(i){return document.querySelectorAll(i)}}});return n.event=t,n}async function h(e){const t=E(e,"[z-swap]");u(`Found ${t.length} z-swap nodes in ${p(e)}`);for(const n of t)try{const o=n.getAttribute("z-swap"),r=z(o,n);for(const i of r){const s=_(i),a=ee(i,s);M(i,a),u(`Added z-swap for '${i.event}' events to ${p(n)}`)}}catch(o){console.error(`ZJAX ERROR – Unable to parse z-swap: ${o.message}
`,n,o.stack)}}function _({handlerString:e,node:t}){e=ie(e);const n=e.split(/\s/);if(n.length<1||n.length>4)throw new Error("Must have between 1 and 4 parts separated by spaces.");const o={},r=[];for(;n.length>0;){const i=n.shift(),s=Q(i);s?o[s[0]]=s[1]:r.push(i)}if(o.swaps=Y(r.join(" ")),o.method||(o.method=t.tagName==="FORM"?"POST":"GET"),!o.endpoint)if(t.tagName==="FORM")o.endpoint=t.action;else if(t.tagName==="A")o.endpoint=t.href;else throw new Error("No endpoint inferrable or specified");return o}function Q(e){if(j.includes(e.toUpperCase()))return["method",e.toUpperCase()];if(/^(\/.*|\.\/.*|https?:\/\/.*|\.)$/.test(e))return["endpoint",e]}function Y(e){const t=[];for(const n of e.split(",")){const o={},r=n.split("->")||[],i=r.pop(),[s,a]=i.split("|"),c=r[0]||"",[f,l]=(c==null?void 0:c.split("|"))||[null,null];if(o.response=f||s,o.target=s,o.responseType=(l==null?void 0:l.trim())||"outer",o.swapType=(a==null?void 0:a.trim())||"outer",o.responseType&&!R.includes(o.responseType))throw new Error(`Invalid swap type: ${o.responseType}`);if(o.swapType&&!C.includes(o.swapType))throw new Error(`Invalid swap type: ${o.swapType}`);if(o.response==="*"&&o.responseType!=="outer")throw new Error('Wild card "*" can not be piped to a Response Type');if(o.target==="*"&&o.swapType!=="outer")throw new Error('Wild card "*" can not be piped to a Swap Type');t.push(o)}return t}function ee(e,t){return async n=>{const o=e.node.tagName==="FORM"&&new FormData(n.target)||null;t.formData=o?ae(o):null,u("z-swap triggered for",t);try{const r=await te(t.method,t.endpoint,t.formData),i=r.body||r.documentElement;for(const s of t.swaps){const a=document.querySelector(s.target);a&&a.classList.add("zjax-swapping");const[c,f]=ne(r,s);u("Parsing incoming response for z-swaps"),c&&(h(c),w(c)),F&&zjax.transitions?document.startViewTransition(()=>{$(f,c,s.swapType,s.responseType)}):$(f,c,s.swapType,s.responseType)}}catch(r){console.error(`ZJAX ERROR – Unable to execute z-swap function: ${r.message}
`,e.node,r.stack)}}}async function te(e,t,n){const o=await fetch(t,{method:e,body:n||null,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!o.ok)throw new Error(`${o.status} ${o.statusText} for ${t}`);const r=new DOMParser().parseFromString(await o.text(),"text/html");return u(`z-swap response from ${t} received and parsed`),r}function ne(e,t){let n;if(t.target==="*"){if(n=document.querySelector("body"),!n)throw new Error("Unable to find body element in local DOM to swap into")}else n=document.querySelector(t.target);const o=t.response==="*"?e:e.querySelector(t.response);if(!n&&t.swapType!=="none")throw new Error(`Target node '${t.target}' does not exist in local DOM`);if(!o&&t.swapType!=="none"&&t.swapType!=="delete")throw new Error(`Source node ${t.response} does not exist in response DOM`);return[o,n]}function oe(e,t){const n={},o=re(e,"[id]");for(const r of o)if(x(t,`[id="${r.id}"]`)){const s=k(r),a=k(t);O(t),D(t,s),n[r.id]=a}return[t,n]}function $(e,t,n,o){t=o==="inner"?t.childNodes:t;let r;[t,r]=oe(e,t);const i=se(t);if(n==="outer"){const s=e.parentNode;for(const a of i)s.insertBefore(a,e);s.removeChild(e),d(t,r);return}if(n==="inner"){e.textContent="";for(const s of i)e.appendChild(s);d(t,r);return}if(n==="before"){for(const s of i)e.parentNode.insertBefore(s,e);d(t,r);return}if(n==="after"){const s=e.parentNode;let a=e;for(const c of i)c===s.lastChild?s.appendChild(c):s.insertBefore(c,a.nextSibling),a=c;d(t,r);return}if(n==="prepend"){const s=e.firstChild;for(const a of i)s?e.insertBefore(a,s):e.appendChild(a);d(t,r);return}if(n==="append"){for(const s of i)e.appendChild(s);d(t,r);return}if(n==="delete"){e.remove();return}}function x(e,t){return e.matches(t)?e:e.querySelector(t)}function re(e,t){const n=[];return e.matches(t)&&n.push(e),n.push(...e.querySelectorAll(t)),n}function k(e){const t=[];for(const n of Array.from(e.attributes).filter(o=>!g.includes(o.name)))t.push([n.name,n.value]);return t}function D(e,t){for(const[n,o]of t)e.setAttribute(n,o)}function O(e){for(const t of Array.from(e.attributes))g.includes(t.name)||e.removeAttribute(t.name)}async function d(e,t){setTimeout(()=>{for(const[n,o]of Object.entries(t)){const r=x(e,`[id="${n}"]`);r&&(O(r),D(r,o))}Object.keys(t).map(n=>`#${n}`).join(", ")},20)}function se(e){if(e instanceof Document){const t=e.querySelector("html");if(t)return Array.from(t.childNodes);const n=document.createDocumentFragment();for(const o of e.childNodes)n.appendChild(o);return Array.from(n.childNodes)}return e instanceof NodeList||Array.isArray(e)?Array.from(e):[e]}function ie(e){return e.replace(/\s*,\s*/g,",")}function ae(e){const t=new URLSearchParams;for(const[n,o]of e.entries())t.append(n,o);return t.toString()}function w(e){const t=E(e,"[z-action]");u(`Found ${t.length} z-action nodes in ${p(e)}`);for(const n of t)try{const o=n.getAttribute("z-action"),r=z(o,n);for(const i of r){const s=ce(i);M(i,s,!0),u(`Added z-action for '${i.event}' events to ${p(n)}`)}}catch(o){console.error(`ZJAX ERROR – Unable to parse z-action: ${o.message}
`,n,o.stack)}}function ce({handlerString:e}){const t=e.match(/^(?:(\w+)\.)?(\w+)$/);if(t){const n=t[1],o=t[2],r=zjax&&zjax.userActions;if(n){if(!(r[n]&&r[n][o]))throw new Error(`Unknown action: ${n}.${o}`);return r[n][o].bind(r[n])}else{if(!r[o])throw new Error(`Unknown action: ${o}`);return r[o].bind(r)}}try{return new Function("$",e)}catch(n){throw new Error(`z-action value is invalid: ${n.message}`)}}window.zjax=J(),document.addEventListener("DOMContentLoaded",()=>{zjax.hotwire||(u("Parsing DOM"),h(document),w(document)),zjax.hotwire&&document.addEventListener("turbo:load",()=>{u("Parsing DOM on turbo:load"),h(document),w(document)});const e=Array.isArray(window.zjax.parseOn)?window.zjax.parseOn:[window.zjax.parseOn];for(const t of e)document.addEventListener(t,()=>{u("Parsing DOM on event",t),h(document),w(document)})})})();
